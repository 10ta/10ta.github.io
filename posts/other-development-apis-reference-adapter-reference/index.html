<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.7"><!-- Canonical URL --><link rel="canonical" href="https://10ta.github.io/posts/other-development-apis-reference-adapter-reference/"><!-- Sitemap --><link rel="sitemap" href="/sitemap-index.xml"><!-- Primary Meta Tags --><title>Astro Adapter API</title><meta name="title" content="Astro Adapter API"><meta name="description" content=""><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://10ta.github.io/posts/other-development-apis-reference-adapter-reference/"><meta property="og:title" content="Astro Adapter API"><meta property="og:description" content=""><meta property="og:image" content="https://10ta.github.io/blog-placeholder-1.avif"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://10ta.github.io/posts/other-development-apis-reference-adapter-reference/"><meta property="twitter:title" content="Astro Adapter API"><meta property="twitter:description" content=""><meta property="twitter:image" content="https://10ta.github.io/blog-placeholder-1.avif"><link rel="stylesheet" href="/_astro/_page_.Bdwf1GY7.css"><script type="module" src="/_astro/hoisted.CPfS8Ggc.js"></script>
<script type="module" src="/_astro/page.DTIbhfSr.js"></script>
<script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.10.2 - MIT builder.io */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,d,l,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(l=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(v,1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.10.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<l.length;n++)(o=r.createElement("script")).innerHTML=l[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(d)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="flex flex-col min-h-screen mx-auto max-w-6xl px-4 dark:prose-invert sm:px-6 lg:px-8"> <header class="z-50 flex w-full flex-wrap py-7 md:flex-nowrap md:justify-start"> <nav class="relative mx-auto flex w-full max-w-7xl basis-full flex-wrap items-center px-4" aria-label="Global"> <div class=""> <a class="flex-none text-xl font-semibold" href="/" aria-label="Astroverse"> AstroMelody </a> </div> <div class="ms-auto flex items-center gap-x-2 py-1"> <a class="inline-flex items-center gap-x-2 rounded-xl border border-transparent px-3 py-2 text-sm font-medium disabled:pointer-events-none disabled:opacity-50" href="/search/" href="/search/"> <i class="icon-base i-tabler-search"></i> </a> <div class="dropdown dropdown-end"> <div tabindex="0" role="button" class="flex size-[38px] items-center justify-center rounded-xl text-sm font-semibold"> <i class="icon-base i-tabler-category-2"></i> </div> <ul tabindex="0" class="menu dropdown-content z-[1] w-52 rounded-box bg-base-100 p-2 shadow"> <li> <a href="/category/One/1/" class="px-4 py-3 font-medium"> One </a> </li><li> <a href="/category/Two/1/" class="px-4 py-3 font-medium"> Two </a> </li><li> <a href="/category/Three/1/" class="px-4 py-3 font-medium"> Three </a> </li> </ul> </div> <label class="swap swap-rotate rounded-xl px-3 py-2 text-sm"> <!-- this hidden checkbox controls the state --> <input type="checkbox" class="theme-controller" data-unchecked-value="corporate" value="halloween"> <!-- sun icon --> <i class="icon-base swap-off i-tabler-sun-filled"></i> <!-- moon icon --> <i class="icon-base swap-on i-tabler-moon-filled"></i> </label> </div> </nav> </header> <!-- Save theme to localStorage --> <script>
  const lightTheme =  document.querySelector('.theme-controller')?.getAttribute('data-unchecked-value');
  // ☝️ This script prevent the FART effect.
  if (localStorage.getItem("theme") === null) {
    document.documentElement.setAttribute("data-theme", lightTheme);
  } else
    document.documentElement.setAttribute(
      "data-theme",
      localStorage.getItem("theme"),
    );
  // "theme" LocalStorage value is set by the package to remember user preference.
  // The value is checked and applyed before rendering anything.
</script>  <!-- 内容区域，确保其动态调整高度 --> <main class="flex-grow">  <main> <article class="prose mx-auto dark:prose-invert"> <div class="prose-h1 text-center"> <h1>Astro Adapter API</h1> </div> <div> <picture> <source srcset="/_astro/photo-1443641723753-250ff9bb3c83_1k4Hzr.avif 392w, /_astro/photo-1443641723753-250ff9bb3c83_8wotI.avif 700w, /_astro/photo-1443641723753-250ff9bb3c83_2vgvhO.avif 980w, /_astro/photo-1443641723753-250ff9bb3c83_Z2nhg62.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1443641723753-250ff9bb3c83_Z2nhg62.avif" srcset="/_astro/photo-1443641723753-250ff9bb3c83_1k4Hzr.avif 392w, /_astro/photo-1443641723753-250ff9bb3c83_8wotI.avif 700w, /_astro/photo-1443641723753-250ff9bb3c83_2vgvhO.avif 980w, /_astro/photo-1443641723753-250ff9bb3c83_Z2nhg62.avif 1960w" alt="black concrete building during daytime" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> </div> <div> <p>Astro is designed to make it easy to deploy to any cloud provider for SSR (server-side rendering). This ability is provided by <strong>adapters</strong>, which are <a href="/en/reference/integrations-reference/">integrations</a>. See the <a href="/en/guides/server-side-rendering/">SSR guide</a> to learn how to use an existing adapter.</p>
<h2 id="what-is-an-adapter">What is an adapter</h2>
<p><a href="#what-is-an-adapter">Section titled What is an adapter</a>
An adapter is a special kind of <a href="/en/reference/integrations-reference/">integration</a> that provides an entrypoint for server-side rendering. An adapter does two things:</p>
<ul>
<li>Implements host-specific APIs for handling requests.</li>
<li>Configures the build according to host conventions.</li>
</ul>
<h2 id="building-an-adapter">Building an Adapter</h2>
<p><a href="#building-an-adapter">Section titled Building an Adapter</a>
An adapter is an <a href="/en/reference/integrations-reference/">integration</a> and can do anything that an integration can do.</p>
<p>An adapter <strong>must</strong> call the <code>setAdapter</code> API in the <code>astro:config:done</code> hook like so:</p>
<p>my-adapter.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export default function createIntegration() {  return {    name: '@matthewp/my-adapter',    hooks: {      'astro:config:done': ({ setAdapter }) => {        setAdapter({          name: '@matthewp/my-adapter',          serverEntrypoint: '@matthewp/my-adapter/server.js',          supportedAstroFeatures: {              staticOutput: 'stable'          }        });      },    },  };}</span></span>
<span class="line"><span></span></span></code></pre>
<p>The object passed into <code>setAdapter</code> is defined as:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>interface AstroAdapter {  name: string;  serverEntrypoint?: string;  previewEntrypoint?: string;  exports?: string[];  args?: any;  adapterFeatures?: AstroAdapterFeatures;  supportedAstroFeatures?: AstroFeatureMap;}</span></span>
<span class="line"><span>export interface AstroAdapterFeatures {  /**   * Creates an edge function that will communicate with the Astro middleware.   */  edgeMiddleware: boolean;  /**   * SSR only. Each route becomes its own function/file.   */  functionPerRoute: boolean;}</span></span>
<span class="line"><span>export type SupportsKind = 'unsupported' | 'stable' | 'experimental' | 'deprecated';</span></span>
<span class="line"><span>export type AstroFeatureMap = {  /**   * The adapter is able to serve static pages   */  staticOutput?: SupportsKind;  /**   * The adapter is able to serve pages that are static or rendered via server   */  hybridOutput?: SupportsKind;  /**   * The adapter is able to serve SSR pages   */  serverOutput?: SupportsKind;  /**   * The adapter can emit static assets   */  assets?: AstroAssetsFeature;};</span></span>
<span class="line"><span>export interface AstroAssetsFeature {  supportKind?: SupportsKind;  /**   * Whether this adapter deploys files in an environment that is compatible with the library `sharp`   */  isSharpCompatible?: boolean;  /**   * Whether this adapter deploys files in an environment that is compatible with the library `squoosh`   */  isSquooshCompatible?: boolean;}</span></span>
<span class="line"><span></span></span></code></pre>
<p>The properties are:</p>
<ul>
<li><strong>name</strong>: A unique name for your adapter, used for logging.</li>
<li><strong>serverEntrypoint</strong>: The entrypoint for server-side rendering.</li>
<li><strong>exports</strong>: An array of named exports when used in conjunction with <code>createExports</code> (explained below).</li>
<li><strong>adapterFeatures</strong>: An object that enables specific features that must be supported by the adapter.
These features will change the built output, and the adapter must implement the proper logic to handle the different output.</li>
<li><strong>supportedAstroFeatures</strong>: A map of Astro built-in features. This allows Astro to determine which features an adapter is unable or unwilling to support so appropriate error messages can be provided.</li>
</ul>
<h3 id="server-entrypoint">Server Entrypoint</h3>
<p><a href="#server-entrypoint">Section titled Server Entrypoint</a>
Astro’s adapter API attempts to work with any type of host, and gives a flexible way to conform to the host APIs.</p>
<h4 id="exports">Exports</h4>
<p><a href="#exports">Section titled Exports</a>
Some serverless hosts expect you to export a function, such as <code>handler</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export function handler(event, context) {  // ...}</span></span>
<span class="line"><span></span></span></code></pre>
<p>With the adapter API you achieve this by implementing <code>createExports</code> in your <code>serverEntrypoint</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { App } from 'astro/app';</span></span>
<span class="line"><span>export function createExports(manifest) {  const app = new App(manifest);</span></span>
<span class="line"><span>  const handler = (event, context) => {    // ...  };</span></span>
<span class="line"><span>  return { handler };}</span></span>
<span class="line"><span></span></span></code></pre>
<p>And then in your integration, where you call <code>setAdapter</code>, provide this name in <code>exports</code>:</p>
<p>my-adapter.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export default function createIntegration() {  return {    name: '@matthewp/my-adapter',    hooks: {      'astro:config:done': ({ setAdapter }) => {        setAdapter({          name: '@matthewp/my-adapter',          serverEntrypoint: '@matthewp/my-adapter/server.js',          exports: ['handler'],        });      },    },  };}</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="start">Start</h4>
<p><a href="#start">Section titled Start</a>
Some hosts expect you to <em>start</em> the server yourselves, for example by listening to a port. For these types of hosts, the adapter API allows you to export a <code>start</code> function which will be called when the bundle script is run.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { App } from 'astro/app';</span></span>
<span class="line"><span>export function start(manifest) {  const app = new App(manifest);</span></span>
<span class="line"><span>  addEventListener('fetch', event => {    // ...  });}</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="astroapp"><code>astro/app</code></h4>
<p><a href="#astroapp">Section titled astro/app</a>
This module is used for rendering pages that have been prebuilt through <code>astro build</code>. Astro uses the standard <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request">Request</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response</a> objects. Hosts that have a different API for request/response should convert to these types in their adapter.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { App } from 'astro/app';import http from 'http';</span></span>
<span class="line"><span>export function start(manifest) {  const app = new App(manifest);</span></span>
<span class="line"><span>  addEventListener('fetch', event => {    event.respondWith(      app.render(event.request)    );  });}</span></span>
<span class="line"><span></span></span></code></pre>
<p>The following methods are provided:</p>
<h5 id="apprenderrequest-request-options-renderoptions"><code>app.render(request: Request, options?: RenderOptions)</code></h5>
<p><a href="#apprenderrequest-request-options-renderoptions">Section titled app.render(request: Request, options?: RenderOptions)</a>
This method calls the Astro page that matches the request, renders it, and returns a Promise to a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response</a> object. This also works for API routes that do not render pages.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>const response = await app.render(request);</span></span>
<span class="line"><span></span></span></code></pre>
<h5 id="renderoptions"><code>RenderOptions</code></h5>
<p><a href="#renderoptions">Section titled RenderOptions</a>
The <code>app.render()</code> method accepts a mandatory <code>request</code> argument, and an optional <code>RenderOptions</code> object for <a href="#addcookieheader"><code>addCookieHeader</code></a>, <a href="#clientaddress"><code>clientAddress</code></a>, <a href="#locals"><code>locals</code></a>, and <a href="#routedata"><code>routeData</code></a>.</p>
<h6 id="addcookieheader"><code>addCookieHeader</code></h6>
<p><a href="#addcookieheader">Section titled addCookieHeader</a>
Whether or not to automatically add all cookies written by <code>Astro.cookie.set()</code> to the response headers.</p>
<p>When set to <code>true</code>, they will be added to the <code>Set-Cookie</code> header of the response as comma separated key-value pairs. You can use the standard <code>response.headers.getSetCookie()</code> API to read them individually.
When set to <code>false</code>(default), the cookies will only be available from <code>App.getSetCookieFromResponse(response)</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>const response = await app.render(request, { addCookieHeader: true });</span></span>
<span class="line"><span></span></span></code></pre>
<h6 id="clientaddress"><code>clientAddress</code></h6>
<p><a href="#clientaddress">Section titled clientAddress</a>
The client IP address that will be made available as <a href="/en/reference/api-reference/#astroclientaddress"><code>Astro.clientAddress</code></a> in pages, and as <code>ctx.clientAddress</code> in API routes and middleware.</p>
<p>The example below reads the <code>x-forwarded-for</code> header and passes it as <code>clientAddress</code>. This value becomes available to the user as <code>Astro.clientAddress</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>const clientAddress = request.headers.get("x-forwarded-for");const response = await app.render(request, { clientAddress });</span></span>
<span class="line"><span></span></span></code></pre>
<h6 id="locals"><code>locals</code></h6>
<p><a href="#locals">Section titled locals</a>
The <a href="/en/reference/api-reference/#contextlocals"><code>context.locals</code> object</a> used to store and access information during the lifecycle of a request.</p>
<p>The example below reads a header named <code>x-private-header</code>, attempts to parse it as an object and pass it to <code>locals</code>, which can then be passed to any <a href="/en/guides/middleware/">middleware function</a>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>const privateHeader = request.headers.get("x-private-header");let locals = {};try {    if (privateHeader) {        locals = JSON.parse(privateHeader);    }} finally {    const response = await app.render(request, { locals });}</span></span>
<span class="line"><span></span></span></code></pre>
<h6 id="routedata"><code>routeData</code></h6>
<p><a href="#routedata">Section titled routeData</a>
Provide a value for <a href="/en/reference/integrations-reference/#routedata-type-reference"><code>routeData</code></a> if you already know the route to render. Doing so will bypass the internal call to <a href="#appmatchrequest"><code>app.match</code></a> to determine the route to render.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>const routeData = app.match(request);if (routeData) {    return app.render(request, { routeData });} else {    /* adapter-specific 404 response */    return new Response(..., { status: 404 });}</span></span>
<span class="line"><span></span></span></code></pre>
<h5 id="appmatchrequest"><code>app.match(request)</code></h5>
<p><a href="#appmatchrequest">Section titled app.match(request)</a>
This method is used to determine if a request is matched by the Astro app’s routing rules.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>if(app.match(request)) {  const response = await app.render(request);}</span></span>
<span class="line"><span></span></span></code></pre>
<p>You can usually call <code>app.render(request)</code> without using <code>.match</code> because Astro handles 404s if you provide a <code>404.astro</code> file. Use <code>app.match(request)</code> if you want to handle 404s in a different way.</p>
<h2 id="allow-installation-via-astro-add">Allow installation via <code>astro add</code></h2>
<p><a href="#allow-installation-via-astro-add">Section titled Allow installation via astro add</a>
<a href="/en/reference/cli-reference/#astro-add">The <code>astro add</code> command</a> allows users to easily add integrations and adapters to their project. If you want <em>your</em> adapter to be installable with this tool, <strong>add <code>astro-adapter</code> to the <code>keywords</code> field in your <code>package.json</code></strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>{  "name": "example",  "keywords": ["astro-adapter"],}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Once you <a href="https://docs.npmjs.com/cli/v8/commands/npm-publish">publish your adapter to npm</a>, running <code>astro add example</code> will install your package with any peer dependencies specified in your <code>package.json</code>. We will also instruct users to update their project config manually.</p>
<h2 id="astro-features">Astro features</h2>
<p><a href="#astro-features">Section titled Astro features</a></p>
<p><strong>Added in:</strong>
<code>astro@3.0.0</code></p>
<p>Astro features are a way for an adapter to tell Astro whether they are able to support a feature, and also the adapter’s level of support.</p>
<p>When using these properties, Astro will:</p>
<ul>
<li>run specific validation;</li>
<li>emit contextual to the logs;</li>
</ul>
<p>These operations are run based on the features supported or not supported, their level of support, and the configuration that the user uses.</p>
<p>The following configuration tells Astro that this adapter has experimental support for assets, but the adapter is not compatible with the built-in services Sharp and Squoosh:</p>
<p>my-adapter.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export default function createIntegration() {  return {    name: '@matthewp/my-adapter',    hooks: {      'astro:config:done': ({ setAdapter }) => {        setAdapter({          name: '@matthewp/my-adapter',          serverEntrypoint: '@matthewp/my-adapter/server.js',          supportedAstroFeatures: {            assets: {              supportKind: "experimental",              isSharpCompatible: false,              isSquooshCompatible: false            }          }        });      },    },  };}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Astro will log a <strong>warning</strong> to the terminal:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[@matthewp/my-adapter] The feature is experimental and subject to issues or changes.</span></span>
<span class="line"><span></span></span></code></pre>
<p>and an error if the service used for assets is not compatible with the adapter:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[@matthewp/my-adapter] The currently selected adapter `@matthewp/my-adapter` is not compatible with the service "Sharp". Your project will NOT be able to build.</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="adapter-features">Adapter features</h2>
<p><a href="#adapter-features">Section titled Adapter features</a>
A set of features that changes the output of the emitted files. When an adapter opts in to these features, they will get additional information inside specific hooks.</p>
<h3 id="functionperroute"><code>functionPerRoute</code></h3>
<p><a href="#functionperroute">Section titled functionPerRoute</a>
This is a feature that is enabled when using SSR only. By default, Astro emits a single <code>entry.mjs</code> file, which is responsible for emitting the rendered page on each request.</p>
<p>When <code>functionPerRoute</code> is <code>true</code>, Astro will instead create a separate file for each route defined in the project.</p>
<p>Each file emitted will only render one page. The pages will be emitted inside a <code>dist/pages/</code> directory (or under a <code>/pages/</code> directory in the directory specified for <a href="/en/reference/configuration-reference/#outdir"><code>outDir</code></a>), and the emitted files will keep the same file paths of the <code>src/pages/</code> directory.</p>
<p>The files inside the <code>pages/</code> directory of the build will mirror the directory structure of your page files in <code>src/pages/</code>, for example:</p>
<ul>
<li>
<p>Directorydist/</p>
<ul>
<li>
<p>Directorypages/</p>
<ul>
<li>
<p>Directoryblog/</p>
<ul>
<li>entry._slug_.astro.mjs</li>
<li>entry.about.astro.mjs</li>
</ul>
</li>
<li>
<p>entry.index.astro.mjs</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Enable the feature by passing <code>true</code> to the adapter.</p>
<p>my-adapter.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export default function createIntegration() {  return {    name: '@matthewp/my-adapter',    hooks: {      'astro:config:done': ({ setAdapter }) => {        setAdapter({          name: '@matthewp/my-adapter',          serverEntrypoint: '@matthewp/my-adapter/server.js',          adapterFeatures: {              functionPerRoute: true          }        });      },    },  };}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Then, consume the hook <a href="/en/reference/integrations-reference/#astrobuildssr"><code>astro:build:ssr</code></a>, which will give you an <code>entryPoints</code> object that maps a page route to the physical file emitted after the build.</p>
<p>my-adapter.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export default function createIntegration() {  return {    name: '@matthewp/my-adapter',    hooks: {      'astro:config:done': ({ setAdapter }) => {        setAdapter({          name: '@matthewp/my-adapter',          serverEntrypoint: '@matthewp/my-adapter/server.js',          adapterFeatures: {              functionPerRoute: true          }        });      },</span></span>
<span class="line"><span>      'astro:build:ssr': ({ entryPoints }) => {          for (const [route, entryFile] of entryPoints) {              // do something with route and entryFile          }      }    },  };}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Caution</p>
<p>The <code>entryFile</code> is of type <code>URL</code> and represents the physical path of the file in the file system. This means that the paths change based on the OS where the code runs.</p>
<h4 id="serverless-environments">Serverless environments</h4>
<p><a href="#serverless-environments">Section titled Serverless environments</a>
Setting <code>functionPerRoute: true</code> in a serverless environment creates a JavaScript file (handler) for each route. A handler might have different names based on your hosting platform: lambda, function, page, etc.</p>
<p>Each of these routes is subject to a <a href="https://azure.microsoft.com/en-us/blog/understanding-serverless-cold-start/">cold start</a> when the handler runs, which may cause some delay. This delay is influenced by different factors.</p>
<p>With <code>functionPerRoute: false</code>, there is only one single handler in charge of rendering all your routes. When this handler is first triggered, you will be subject to a cold start. Then, all other routes should function without delay. However, you will lose the benefit of code splitting that <code>functionPerRoute: true</code> provides.</p>
<p>Note</p>
<p>It’s important that you understand your hosting platform, and how it works, in order to choose the appropriate <code>functionPerRoute</code> configuration for your project.</p>
<h3 id="edgemiddleware"><code>edgeMiddleware</code></h3>
<p><a href="#edgemiddleware">Section titled edgeMiddleware</a>
Defines whether any SSR middleware code will be bundled when built.</p>
<p>When enabled, this prevents middleware code from being bundled and imported by all pages during the build:</p>
<p>my-adapter.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export default function createIntegration() {  return {    name: '@matthewp/my-adapter',    hooks: {      'astro:config:done': ({ setAdapter }) => {        setAdapter({          name: '@matthewp/my-adapter',          serverEntrypoint: '@matthewp/my-adapter/server.js',          adapterFeatures: {              edgeMiddleware: true          }        });      },    },  };}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Then, consume the hook <a href="/en/reference/integrations-reference/#astrobuildssr"><code>astro:build:ssr</code></a>, which will give you a <code>middlewareEntryPoint</code>, an <code>URL</code> to the physical file on the file system.</p>
<p>my-adapter.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export default function createIntegration() {  return {    name: '@matthewp/my-adapter',    hooks: {      'astro:config:done': ({ setAdapter }) => {        setAdapter({          name: '@matthewp/my-adapter',          serverEntrypoint: '@matthewp/my-adapter/server.js',          adapterFeatures: {              edgeMiddleware: true          }        });      },</span></span>
<span class="line"><span>      'astro:build:ssr': ({ middlewareEntryPoint }) => {          // remember to check if this property exits, it will be `undefined` if the adapter doesn't opt in to the feature          if (middlewareEntryPoint) {             createEdgeMiddleware(middlewareEntryPoint)          }      }    },  };}</span></span>
<span class="line"><span>function createEdgeMiddleware(middlewareEntryPoint) {    // emit a new physical file using your bundler}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Reference</p> </div> <div class="prose-a:no-underline flex gap-2"> <span class="badge badge-outline badge-md"> <a href="/tags/astro/1/">astro</a> </span><span class="badge badge-outline badge-md"> <a href="/tags/CSharp/1/">CSharp</a> </span><span class="badge badge-outline badge-md"> <a href="/tags/Sass/1/">Sass</a> </span> </div> <div class="mt-4 flex justify-between"> <small>Publish on <span class="font-weight-bold">2024-01-30</span>，Update on <span class="font-weight-bold">2025-01-09</span></small> </div> </article> <div class="mt-12"> <div class="grid grid-cols-1 gap-4 md:grid-cols-3"> <div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/manage-your-content-guides-markdown-content/"> <picture> <source srcset="/_astro/photo-1472377723522-4768db9c41ce_cr2OL.avif 392w, /_astro/photo-1472377723522-4768db9c41ce_ZY6gfW.avif 700w, /_astro/photo-1472377723522-4768db9c41ce_1nCPx9.avif 980w, /_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif" srcset="/_astro/photo-1472377723522-4768db9c41ce_cr2OL.avif 392w, /_astro/photo-1472377723522-4768db9c41ce_ZY6gfW.avif 700w, /_astro/photo-1472377723522-4768db9c41ce_1nCPx9.avif 980w, /_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif 1960w" alt="white and brown concrete house near trees at daytime" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">astro-build</span><span class="badge badge-outline">Go</span><span class="badge badge-outline">Css</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-02-21</span></p> <h2 class="card-title">Markdown in Astro</h2> </div> </a> </div><div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/welcome-world-guides-deploy/"> <picture> <source srcset="/_astro/photo-1480074568708-e7b720bb3f09_Z2vlXMC.avif 392w, /_astro/photo-1480074568708-e7b720bb3f09_1nhPUA.avif 700w, /_astro/photo-1480074568708-e7b720bb3f09_Z1kab5f.avif 980w, /_astro/photo-1480074568708-e7b720bb3f09_vUEOm.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1480074568708-e7b720bb3f09_vUEOm.avif" srcset="/_astro/photo-1480074568708-e7b720bb3f09_Z2vlXMC.avif 392w, /_astro/photo-1480074568708-e7b720bb3f09_1nhPUA.avif 700w, /_astro/photo-1480074568708-e7b720bb3f09_Z1kab5f.avif 980w, /_astro/photo-1480074568708-e7b720bb3f09_vUEOm.avif 1960w" alt="white house under maple trees" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">guide</span><span class="badge badge-outline">CSharp</span><span class="badge badge-outline">Sass</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-02-16</span></p> <h2 class="card-title">Deploy your Astro Site</h2> </div> </a> </div><div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/core-concepts-concepts-islands/"> <picture> <source srcset="/_astro/photo-1483366774565-c783b9f70e2c_jGYEQ.avif 392w, /_astro/photo-1483366774565-c783b9f70e2c_ZQPjpR.avif 700w, /_astro/photo-1483366774565-c783b9f70e2c_1uSMne.avif 980w, /_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif" srcset="/_astro/photo-1483366774565-c783b9f70e2c_jGYEQ.avif 392w, /_astro/photo-1483366774565-c783b9f70e2c_ZQPjpR.avif 700w, /_astro/photo-1483366774565-c783b9f70e2c_1uSMne.avif 980w, /_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif 1960w" alt="worm's-eye view photography of concrete building" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">tutorial</span><span class="badge badge-outline">CSharp</span><span class="badge badge-outline">Less</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-02-12</span></p> <h2 class="card-title">Astro Islands</h2> </div> </a> </div> </div> </div> </main>  </main> <footer class="mx-auto mt-auto w-full max-w-[85rem] py-10"> <nav class="mx-auto w-full max-w-[85rem] px-4" aria-label="Footer"> <div class="flex flex-col items-center sm:flex-row sm:justify-between"> <div id="navbar-alignment" class="internal-links sm:order-2"> <div class="mt-2 flex flex-row gap-5 sm:mt-0 sm:flex-row sm:items-center sm:ps-5"> <a href="/posts/core-concepts-concepts-why-astro/" class="inline-flex gap-x-2 text-sm"> Astro </a><a href="/posts/assets-guides-styling/" class="inline-flex gap-x-2 text-sm"> Styling </a><a href="/tags/" class="inline-flex gap-x-2 text-sm"> Tags </a> </div> </div> <div class="mt-2 flex flex-wrap gap-2 sm:order-3 sm:mb-0 sm:gap-0"> <button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="/rss.xml" class="absolute inset-0 z-10" aria-label="RSS"></a> <i class="i-tabler-rss icon-base"></i> </button><button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="https://twitter.com/astrodotbuild" class="absolute inset-0 z-10" aria-label="Twitter"></a> <i class="i-tabler-brand-twitter icon-base"></i> </button><button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="https://github.com/isooosi" class="absolute inset-0 z-10" aria-label="GitHub"></a> <i class="i-tabler-brand-github icon-base"></i> </button> </div> <div class="mt-2 sm:order-1 sm:mb-0"> <a class="flex-none text-sm" href="/" aria-label="Brand">AstroMelody &copy; 2025</a> </div> </div> </nav> </footer> </body></html>