<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.7"><!-- Canonical URL --><link rel="canonical" href="https://10ta.github.io/posts/other-development-apis-reference-integrations-reference/"><!-- Sitemap --><link rel="sitemap" href="/sitemap-index.xml"><!-- Primary Meta Tags --><title>Astro Integration API</title><meta name="title" content="Astro Integration API"><meta name="description" content=""><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://10ta.github.io/posts/other-development-apis-reference-integrations-reference/"><meta property="og:title" content="Astro Integration API"><meta property="og:description" content=""><meta property="og:image" content="https://10ta.github.io/blog-placeholder-1.avif"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://10ta.github.io/posts/other-development-apis-reference-integrations-reference/"><meta property="twitter:title" content="Astro Integration API"><meta property="twitter:description" content=""><meta property="twitter:image" content="https://10ta.github.io/blog-placeholder-1.avif"><link rel="stylesheet" href="/_astro/_page_.Bdwf1GY7.css"><script type="module" src="/_astro/hoisted.CPfS8Ggc.js"></script>
<script type="module" src="/_astro/page.DTIbhfSr.js"></script>
<script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.10.2 - MIT builder.io */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,d,l,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(l=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(v,1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.10.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<l.length;n++)(o=r.createElement("script")).innerHTML=l[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(d)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="flex flex-col min-h-screen mx-auto max-w-6xl px-4 dark:prose-invert sm:px-6 lg:px-8"> <header class="z-50 flex w-full flex-wrap py-7 md:flex-nowrap md:justify-start"> <nav class="relative mx-auto flex w-full max-w-7xl basis-full flex-wrap items-center px-4" aria-label="Global"> <div class=""> <a class="flex-none text-xl font-semibold" href="/" aria-label="Astroverse"> AstroMelody </a> </div> <div class="ms-auto flex items-center gap-x-2 py-1"> <a class="inline-flex items-center gap-x-2 rounded-xl border border-transparent px-3 py-2 text-sm font-medium disabled:pointer-events-none disabled:opacity-50" href="/search/" href="/search/"> <i class="icon-base i-tabler-search"></i> </a> <div class="dropdown dropdown-end"> <div tabindex="0" role="button" class="flex size-[38px] items-center justify-center rounded-xl text-sm font-semibold"> <i class="icon-base i-tabler-category-2"></i> </div> <ul tabindex="0" class="menu dropdown-content z-[1] w-52 rounded-box bg-base-100 p-2 shadow"> <li> <a href="/category/One/1/" class="px-4 py-3 font-medium"> One </a> </li><li> <a href="/category/Two/1/" class="px-4 py-3 font-medium"> Two </a> </li><li> <a href="/category/Three/1/" class="px-4 py-3 font-medium"> Three </a> </li> </ul> </div> <label class="swap swap-rotate rounded-xl px-3 py-2 text-sm"> <!-- this hidden checkbox controls the state --> <input type="checkbox" class="theme-controller" data-unchecked-value="corporate" value="halloween"> <!-- sun icon --> <i class="icon-base swap-off i-tabler-sun-filled"></i> <!-- moon icon --> <i class="icon-base swap-on i-tabler-moon-filled"></i> </label> </div> </nav> </header> <!-- Save theme to localStorage --> <script>
  const lightTheme =  document.querySelector('.theme-controller')?.getAttribute('data-unchecked-value');
  // ☝️ This script prevent the FART effect.
  if (localStorage.getItem("theme") === null) {
    document.documentElement.setAttribute("data-theme", lightTheme);
  } else
    document.documentElement.setAttribute(
      "data-theme",
      localStorage.getItem("theme"),
    );
  // "theme" LocalStorage value is set by the package to remember user preference.
  // The value is checked and applyed before rendering anything.
</script>  <!-- 内容区域，确保其动态调整高度 --> <main class="flex-grow">  <main> <article class="prose mx-auto dark:prose-invert"> <div class="prose-h1 text-center"> <h1>Astro Integration API</h1> </div> <div> <picture> <source srcset="/_astro/photo-1414438992182-69e404046f80_ZV2v1D.avif 392w, /_astro/photo-1414438992182-69e404046f80_Z27zO7m.avif 700w, /_astro/photo-1414438992182-69e404046f80_f9hFJ.avif 980w, /_astro/photo-1414438992182-69e404046f80_Z1na9tu.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1414438992182-69e404046f80_Z1na9tu.avif" srcset="/_astro/photo-1414438992182-69e404046f80_ZV2v1D.avif 392w, /_astro/photo-1414438992182-69e404046f80_Z27zO7m.avif 700w, /_astro/photo-1414438992182-69e404046f80_f9hFJ.avif 980w, /_astro/photo-1414438992182-69e404046f80_Z1na9tu.avif 1960w" alt="Leaning Tower of Pisa, Italy" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> </div> <div> <p><strong>Astro Integrations</strong> add new functionality and behaviors for your project with only a few lines of code.</p>
<p>This reference page is for anyone writing their own integration. To learn how to use an integration in your project, check out our <a href="/en/guides/integrations-guide/">Using Integrations</a> guide instead.</p>
<h2 id="examples">Examples</h2>
<p><a href="#examples">Section titled Examples</a>
The official Astro integrations can act as reference for you as you go to build your own integrations.</p>
<ul>
<li><strong>Renderers:</strong> <a href="/en/guides/integrations-guide/lit/"><code>lit</code></a>, <a href="/en/guides/integrations-guide/svelte/"><code>svelte</code></a>, <a href="/en/guides/integrations-guide/react/"><code>react</code></a>, <a href="/en/guides/integrations-guide/preact/"><code>preact</code></a>, <a href="/en/guides/integrations-guide/vue/"><code>vue</code></a>, <a href="/en/guides/integrations-guide/solid-js/"><code>solid</code></a></li>
<li><strong>Libraries:</strong> <a href="/en/guides/integrations-guide/tailwind/"><code>tailwind</code></a>, <a href="/en/guides/integrations-guide/partytown/"><code>partytown</code></a></li>
<li><strong>Features:</strong> <a href="/en/guides/integrations-guide/sitemap/"><code>sitemap</code></a></li>
</ul>
<h2 id="quick-api-reference">Quick API Reference</h2>
<p><a href="#quick-api-reference">Section titled Quick API Reference</a></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>interface AstroIntegration {  name: string;  hooks: {    'astro:config:setup'?: (options: {      config: AstroConfig;      command: 'dev' | 'build' | 'preview' | 'sync';      isRestart: boolean;      updateConfig: (newConfig: DeepPartial&#x3C;AstroConfig>) => AstroConfig;      addRenderer: (renderer: AstroRenderer) => void;      addWatchFile: (path: URL | string) => void;      addClientDirective: (directive: ClientDirectiveConfig) => void;      addMiddleware: (middleware: AstroIntegrationMiddleware) => void;      addDevToolbarApp: (pluginEntrypoint: string) => void;      injectScript: (stage: InjectedScriptStage, content: string) => void;      injectRoute: (injectedRoute: { pattern: string, entrypoint: string }) => void;      logger: AstroIntegrationLogger;    }) => void | Promise&#x3C;void>;    'astro:config:done'?: (options: {      config: AstroConfig;      setAdapter: (adapter: AstroAdapter) => void;      injectTypes: (injectedType: { filename: string; content: string }) => URL;      logger: AstroIntegrationLogger;      }) => void | Promise&#x3C;void>;    'astro:route:setup'?: (options: { route: RouteOptions; logger: AstroIntegrationLogger; }) => void | Promise&#x3C;void>;    'astro:server:setup'?: (options: { server: vite.ViteDevServer; logger: AstroIntegrationLogger; }) => void | Promise&#x3C;void>;    'astro:server:start'?: (options: { address: AddressInfo; logger: AstroIntegrationLogger; }) => void | Promise&#x3C;void>;    'astro:server:done'?: (options: { logger: AstroIntegrationLogger; }) => void | Promise&#x3C;void>;    'astro:build:start'?: (options: { logger: AstroIntegrationLogger; }) => void | Promise&#x3C;void>;    'astro:build:setup'?: (options: {      vite: ViteConfigWithSSR;      pages: Map&#x3C;string, PageBuildData>;      target: 'client' | 'server';      logger: AstroIntegrationLogger;    }) => void | Promise&#x3C;void>;    'astro:build:generated'?: (options: { dir: URL; logger: AstroIntegrationLogger; }) => void | Promise&#x3C;void>;    'astro:build:ssr'?: (options: {        manifest: SerializedSSRManifest;        entryPoints: Map&#x3C;RouteData, URL>;        logger: AstroIntegrationLogger;    }) => void | Promise&#x3C;void>;    'astro:build:done'?: (options: { dir: URL; routes: RouteData[]; logger: AstroIntegrationLogger; }) => void | Promise&#x3C;void>;</span></span>
<span class="line"><span>    // ... any custom hooks from integrations  };}</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="hooks">Hooks</h2>
<p><a href="#hooks">Section titled Hooks</a>
Astro provides hooks that integrations can implement to execute during certain parts of Astro’s lifecycle. Astro hooks are defined in the <code>IntegrationHooks</code> interface, which is part of the global <code>Astro</code> namespace.</p>
<p>The following hooks are built in to Astro:</p>
<h3 id="astroconfigsetup"><code>astro:config:setup</code></h3>
<p><a href="#astroconfigsetup">Section titled astro:config:setup</a>
<strong>Next hook:</strong> <a href="#astroconfigdone"><code>astro:config:done</code></a></p>
<p><strong>When:</strong> On initialization, before either the <a href="https://vite.dev/config/">Vite</a> or <a href="/en/reference/configuration-reference/">Astro config</a> have resolved.</p>
<p><strong>Why:</strong> To extend the project config. This includes updating the <a href="/en/reference/configuration-reference/">Astro config</a>, applying <a href="https://vite.dev/guide/api-plugin.html">Vite plugins</a>, adding component renderers, and injecting scripts onto the page.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:config:setup'?: (options: {  config: AstroConfig;  command: 'dev' | 'build' | 'preview' | 'sync';  isRestart: boolean;  updateConfig: (newConfig: DeepPartial&#x3C;AstroConfig>) => AstroConfig;  addRenderer: (renderer: AstroRenderer) => void;  addClientDirective: (directive: ClientDirectiveConfig) => void;  addMiddleware: (middleware: AstroIntegrationMiddleware) => void;  addDevToolbarApp: (pluginEntrypoint: string) => void;  addWatchFile: (path: URL | string) => void;  injectScript: (stage: InjectedScriptStage, content: string) => void;  injectRoute: ({ pattern: string, entrypoint: string }) => void;  logger: AstroIntegrationLogger;}) => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="config-option"><code>config</code> option</h4>
<p><a href="#config-option">Section titled config option</a>
<strong>Type:</strong> <code>AstroConfig</code></p>
<p>A read-only copy of the user-supplied <a href="/en/reference/configuration-reference/">Astro config</a>. This is resolved <em>before</em> any other integrations have run. If you need a copy of the config after all integrations have completed their config updates, <a href="#astroconfigdone">see the <code>astro:config:done</code> hook</a>.</p>
<h4 id="command-option"><code>command</code> option</h4>
<p><a href="#command-option">Section titled command option</a>
<strong>Type:</strong> <code>'dev' | 'build' | 'preview' | 'sync'</code></p>
<ul>
<li><code>dev</code> - Project is executed with <code>astro dev</code></li>
<li><code>build</code> - Project is executed with <code>astro build</code></li>
<li><code>preview</code> - Project is executed with <code>astro preview</code></li>
<li><code>sync</code> - Project is executed with <code>astro sync</code></li>
</ul>
<h4 id="isrestart-option"><code>isRestart</code> option</h4>
<p><a href="#isrestart-option">Section titled isRestart option</a>
<strong>Type:</strong> <code>boolean</code></p>
<p><code>false</code> when the dev server starts, <code>true</code> when a reload is triggered. Useful to detect when this function is called more than once.</p>
<h4 id="updateconfig-option"><code>updateConfig</code> option</h4>
<p><a href="#updateconfig-option">Section titled updateConfig option</a>
<strong>Type:</strong> <code>(newConfig: DeepPartial&#x3C;AstroConfig>) => AstroConfig;</code></p>
<p>A callback function to update the user-supplied <a href="/en/reference/configuration-reference/">Astro config</a>. Any config you provide <strong>will be merged with the user config + other integration config updates,</strong> so you are free to omit keys!</p>
<p>For example, say you need to supply a <a href="https://vite.dev/">Vite</a> plugin to the user’s project:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import bananaCSS from '@vitejs/official-banana-css-plugin';</span></span>
<span class="line"><span>export default {  name: 'banana-css-integration',  hooks: {    'astro:config:setup': ({ updateConfig }) => {      updateConfig({        vite: {          plugins: [bananaCSS()],        }      })    }  }}</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="addrenderer-option"><code>addRenderer</code> option</h4>
<p><a href="#addrenderer-option">Section titled addRenderer option</a>
<strong>Type:</strong> <code>(renderer:</code> <a href="https://github.com/withastro/astro/blob/fdd607c5755034edf262e7b275732519328a33b2/packages/astro/src/%40types/astro.ts#L872-L883"><code>AstroRenderer</code></a> <code>) => void;</code>
<strong>Examples:</strong> <a href="https://github.com/withastro/astro/blob/main/packages/integrations/lit/src/index.ts"><code>lit</code></a>, <a href="https://github.com/withastro/astro/blob/main/packages/integrations/svelte/src/index.ts"><code>svelte</code></a>, <a href="https://github.com/withastro/astro/blob/main/packages/integrations/react/src/index.ts"><code>react</code></a>, <a href="https://github.com/withastro/astro/blob/main/packages/integrations/preact/src/index.ts"><code>preact</code></a>, <a href="https://github.com/withastro/astro/blob/main/packages/integrations/vue/src/index.ts"><code>vue</code></a>, <a href="https://github.com/withastro/astro/blob/main/packages/integrations/solid/src/index.ts"><code>solid</code></a></p>
<p>A callback function to add a component framework renderer (i.e. React, Vue, Svelte, etc). You can browse the examples and type definition above for more advanced options, but here are the 2 main options to be aware of:</p>
<ul>
<li><code>clientEntrypoint</code> - path to a file that executes on the client whenever your component is used. This is mainly for rendering or hydrating your component with JS.</li>
<li><code>serverEntrypoint</code> - path to a file that executes during server-side requests or static builds whenever your component is used. These should render components to static markup, with hooks for hydration where applicable. <a href="https://react.dev/reference/react-dom/server/renderToString">React’s <code>renderToString</code> callback</a> is a classic example.</li>
</ul>
<h4 id="addwatchfile-option"><code>addWatchFile</code> option</h4>
<p><a href="#addwatchfile-option">Section titled addWatchFile option</a>
<strong>Type:</strong> <code>URL | string</code></p>
<p>If your integration depends on some configuration file that Vite doesn’t watch and/or needs a full dev server restart to take effect, add it with <code>addWatchFile</code>. Whenever that file changes, the Astro dev server will be reloaded (you can check when a reload happens with <code>isRestart</code>).</p>
<p>Example usage:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>// Must be an absolute path!addWatchFile('/home/user/.../my-config.json');addWatchFile(new URL('./tailwind.config.js', config.root));</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="addclientdirective-option"><code>addClientDirective</code> option</h4>
<p><a href="#addclientdirective-option">Section titled addClientDirective option</a></p>
<p><strong>Added in:</strong>
<code>astro@2.6.0</code></p>
<p><strong>Type:</strong> <code>(directive:</code> <a href="https://github.com/withastro/astro/blob/00327c213f74627ac9ca1dec774efa5bf71e9375/packages/astro/src/%40types/astro.ts#L1872-L1875"><code>ClientDirectiveConfig</code></a> <code>) => void;</code></p>
<p>Adds a <a href="/en/reference/directives-reference/#custom-client-directives">custom client directive</a> to be used in <code>.astro</code> files.</p>
<p>Note that directive entrypoints are only bundled through esbuild and should be kept small so they don’t slow down component hydration.</p>
<p>Example usage:</p>
<p>astro.config.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineConfig } from 'astro/config';import clickDirective from './astro-click-directive/register.js'</span></span>
<span class="line"><span>// https://astro.build/configexport default defineConfig({  integrations: [    clickDirective()  ],});</span></span>
<span class="line"><span></span></span></code></pre>
<p>astro-click-directive/register.js</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>/** * @type {() => import('astro').AstroIntegration} */export default () => ({  name: "client:click",  hooks: {    "astro:config:setup": ({ addClientDirective }) => {      addClientDirective({        name: "click",        entrypoint: "./astro-click-directive/click.js",      });    },  },});</span></span>
<span class="line"><span></span></span></code></pre>
<p>astro-click-directive/click.js</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>/** * Hydrate on first click on the window * @type {import('astro').ClientDirective} */export default (load, opts, el) => {  window.addEventListener('click', async () => {    const hydrate = await load()    await hydrate()  }, { once: true })}</span></span>
<span class="line"><span></span></span></code></pre>
<p>You can also add types for the directives in your library’s type definition file:</p>
<p>astro-click-directive/index.d.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import 'astro'declare module 'astro' {  interface AstroClientDirectives {    'client:click'?: boolean  }}</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="adddevtoolbarapp-option"><code>addDevToolbarApp</code> option</h4>
<p><a href="#adddevtoolbarapp-option">Section titled addDevToolbarApp option</a></p>
<p><strong>Added in:</strong>
<code>astro@3.4.0</code></p>
<p><strong>Type:</strong> <code>(pluginEntrypoint: string) => void;</code></p>
<p>Adds a <a href="/en/reference/dev-toolbar-app-reference/">custom dev toolbar app</a>.</p>
<p>Example usage:</p>
<p>astro.config.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineConfig } from 'astro/config';import devToolbarIntegration from './astro-dev-toolbar-app/integration.js'</span></span>
<span class="line"><span>// https://astro.build/configexport default defineConfig({  integrations: [    devToolbarIntegration()  ],});</span></span>
<span class="line"><span></span></span></code></pre>
<p>astro-dev-toolbar-app/integration.js</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>/** * @type {() => import('astro').AstroIntegration} */export default () => ({  name: "dev-toolbar-app",  hooks: {    "astro:config:setup": ({ addDevToolbarApp }) => {      addDevToolbarApp("./astro-dev-toolbar-app/plugin.js");    },  },});</span></span>
<span class="line"><span></span></span></code></pre>
<p>astro-dev-toolbar-app/plugin.js</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>/** * @type {import('astro').DevToolbarApp} */export default {  id: "my-plugin",  name: "My Plugin",  icon: "&#x3C;svg>...&#x3C;/svg>",  init() {    console.log("I'm a dev toolbar app!")  },};</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="addmiddleware-option"><code>addMiddleware</code> option</h4>
<p><a href="#addmiddleware-option">Section titled addMiddleware option</a></p>
<p><strong>Added in:</strong>
<code>astro@3.5.0</code></p>
<p><strong>Type:</strong> <code>(middleware:</code> <a href="https://github.com/withastro/astro/blob/852ac0f75dfca1b2602e9cdbfa0447d9998e2449/packages/astro/src/%40types/astro.ts#L2124-L2127"><code>AstroIntegrationMiddleware</code></a> <code>) => void;</code></p>
<p>Adds <a href="/en/guides/middleware/">middleware</a> to run on each request. Takes the <code>entrypoint</code> module that contains the middleware, and an <code>order</code> to specify whether it should run before (<code>pre</code>) other middleware or after (<code>post</code>).</p>
<p>@my-package/integration.js</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>/** * @type {() => import('astro').AstroIntegration} */export default () => ({  name: "my-middleware-package",  hooks: {    "astro:config:setup": ({ addMiddleware }) => {        addMiddleware({          entrypoint: '@my-package/middleware',          order: 'pre'        });    },  },});</span></span>
<span class="line"><span></span></span></code></pre>
<p>Middleware is defined in a package with an <code>onRequest</code> function, as with user-defined middleware.</p>
<p>@my-package/middleware.js</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineMiddleware } from 'astro:middleware';</span></span>
<span class="line"><span>export const onRequest = defineMiddleware(async (context, next) => {  if(context.url.pathname === '/some-test-path') {    return Response.json({      ok: true    });  }</span></span>
<span class="line"><span>  return next();});</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="injectroute-option"><code>injectRoute</code> option</h4>
<p><a href="#injectroute-option">Section titled injectRoute option</a>
<strong>Type:</strong> <code>({ pattern: string, entrypoint: string }) => void;</code></p>
<p>A callback function to inject routes into an Astro project. Injected routes can be <a href="/en/basics/astro-pages/"><code>.astro</code> pages</a> or <a href="/en/guides/endpoints/#static-file-endpoints"><code>.js</code> and <code>.ts</code> route handlers</a>.</p>
<p><code>injectRoute</code> takes an object with a <code>pattern</code> and an <code>entrypoint</code>.</p>
<ul>
<li><code>pattern</code> - where the route should be output in the browser, for example <code>/foo/bar</code>. A <code>pattern</code> can use Astro’s filepath syntax for denoting dynamic routes, for example <code>/foo/[bar]</code> or <code>/foo/[...bar]</code>. Note that a file extension is <strong>not</strong> needed in the <code>pattern</code>.</li>
<li><code>entrypoint</code> - a bare module specifier pointing towards the <code>.astro</code> page or <code>.js</code>/<code>.ts</code> route handler that handles the route denoted in the <code>pattern</code>.</li>
</ul>
<h5 id="example-usage">Example usage</h5>
<p><a href="#example-usage">Section titled Example usage</a></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>injectRoute({  // Use Astro’s pattern syntax for dynamic routes.  pattern: '/subfolder/[dynamic]',  // Use relative path syntax for a local route.  entrypoint: './src/dynamic-page.astro'});</span></span>
<span class="line"><span></span></span></code></pre>
<p>For an integration designed to be installed in other projects, use its package name to refer to the route entrypoint.
The following example shows a package published to npm as <code>@fancy/dashboard</code> injecting a dashboard route:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>injectRoute({  pattern: '/fancy-dashboard',  entrypoint: '@fancy/dashboard/dashboard.astro'});</span></span>
<span class="line"><span></span></span></code></pre>
<p>When publishing your package (<code>@fancy/dashboard</code>, in this case) to npm, you must export <code>dashboard.astro</code> in your <code>package.json</code>:</p>
<p>package.json</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>{  "name": "@fancy/dashboard",  // ...  "exports": { "./dashboard.astro": "./dashboard.astro" }}</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="injectscript-option"><code>injectScript</code> option</h4>
<p><a href="#injectscript-option">Section titled injectScript option</a>
<strong>Type:</strong> <code>(stage: InjectedScriptStage, content: string) => void;</code></p>
<p>A callback function to inject a string of JavaScript content onto every page.</p>
<p>The <strong><code>stage</code></strong> denotes how this script (the <code>content</code>) should be inserted. Some stages allow inserting scripts without modification, while others allow optimization during <a href="https://vite.dev/guide/build.html">Vite’s bundling step</a>:</p>
<ul>
<li><code>"head-inline"</code>: Injected into a script tag in the <code>&#x3C;head></code> of every page. <strong>Not</strong> optimized or resolved by Vite.</li>
<li><code>"before-hydration"</code>: Imported client-side, before the hydration script runs. Optimized and resolved by Vite.</li>
<li><code>"page"</code>: Similar to <code>head-inline</code>, except that the injected snippet is handled by Vite and bundled with any other <code>&#x3C;script></code> tags defined inside of Astro components on the page. The script will be loaded with a <code>&#x3C;script type="module"></code> in the final page output, optimized and resolved by Vite.</li>
<li><code>"page-ssr"</code>: Imported as a separate module in the frontmatter of every Astro page component. Because this stage imports your script, the <code>Astro</code> global is not available and your script will only be run once when the <code>import</code> is first evaluated.</li>
</ul>
<p>The main use for the <code>page-ssr</code> stage is injecting a CSS <code>import</code> into every page to be optimized and resolved by Vite:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>injectScript('page-ssr', 'import "global-styles.css";');</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="astroconfigdone"><code>astro:config:done</code></h3>
<p><a href="#astroconfigdone">Section titled astro:config:done</a>
<strong>Previous hook:</strong> <a href="#astroconfigsetup"><code>astro:config:setup</code></a></p>
<p><strong>Next hook:</strong> <a href="#astroserversetup"><code>astro:server:setup</code></a> when running in “dev” mode, or <a href="#astrobuildstart"><code>astro:build:start</code></a> during production builds</p>
<p><strong>When:</strong> After the Astro config has resolved and other integrations have run their <code>astro:config:setup</code> hooks.</p>
<p><strong>Why:</strong> To retrieve the final config for use in other hooks.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:config:done'?: (options: {  config: AstroConfig;  setAdapter: (adapter: AstroAdapter) => void;  injectTypes: (injectedType: { filename: string; content: string }) => URL;  logger: AstroIntegrationLogger;}) => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="config-option-1"><code>config</code> option</h4>
<p><a href="#config-option-1">Section titled config option</a>
<strong>Type:</strong> <code>AstroConfig</code></p>
<p>A read-only copy of the user-supplied <a href="/en/reference/configuration-reference/">Astro config</a>. This is resolved <em>after</em> other integrations have run.</p>
<h4 id="setadapter-option"><code>setAdapter</code> option</h4>
<p><a href="#setadapter-option">Section titled setAdapter option</a>
<strong>Type:</strong> <code>(adapter: AstroAdapter) => void;</code></p>
<p>Makes the integration an adapter. Read more in the <a href="/en/reference/adapter-reference/">adapter API</a>.</p>
<h4 id="injecttypes-options"><code>injectTypes</code> options</h4>
<p><a href="#injecttypes-options">Section titled injectTypes options</a></p>
<p><strong>Added in:</strong>
<code>astro@4.14.0</code></p>
<p><strong>Type:</strong> <code>(injectedType: { filename: string; content: string }) => URL</code></p>
<p>Allows you to inject types into your user’s project by adding a new <code>*.d.ts</code> file.</p>
<p>The <code>filename</code> property will be used to generate a file at <code>/.astro/integrations/&#x3C;normalized_integration_name>/&#x3C;normalized_filename>.d.ts</code> and must end with <code>".d.ts"</code>.</p>
<p>The <code>content</code> property will create the body of the file and must be valid TypeScript.</p>
<p>Additionally, <code>injectTypes()</code> returns a URL to the normalized path so you can overwrite its content later on, or manipulate it in any way you want.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>const path = injectTypes({  filename: "types.d.ts",  content: "declare module 'virtual:integration' {}"})console.log(path) // URL</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="astroserversetup"><code>astro:server:setup</code></h3>
<p><a href="#astroserversetup">Section titled astro:server:setup</a>
<strong>Previous hook:</strong> <a href="#astroconfigdone"><code>astro:config:done</code></a></p>
<p><strong>Next hook:</strong> <a href="#astroserverstart"><code>astro:server:start</code></a></p>
<p><strong>When:</strong> Just after the Vite server is created in “dev” mode, but before the <code>listen()</code> event is fired. <a href="https://vite.dev/guide/api-javascript.html#createserver">See Vite’s createServer API</a> for more.</p>
<p><strong>Why:</strong> To update Vite server options and middleware.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:server:setup'?: (options: { server: vite.ViteDevServer }) => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="server-option"><code>server</code> option</h4>
<p><a href="#server-option">Section titled server option</a>
<strong>Type:</strong> <a href="https://vite.dev/guide/api-javascript.html#vitedevserver"><code>ViteDevServer</code></a></p>
<p>A mutable instance of the Vite server used in “dev” mode. For instance, this is <a href="/en/guides/integrations-guide/partytown/">used by our Partytown integration</a> to inject the Partytown server as middleware:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export default {  name: 'partytown',  hooks: {    'astro:server:setup': ({ server }) => {      server.middlewares.use(        function middleware(req, res, next) {          // handle requests        }      );    }  }}</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="astroserverstart"><code>astro:server:start</code></h3>
<p><a href="#astroserverstart">Section titled astro:server:start</a>
<strong>Previous hook:</strong> <a href="#astroserversetup"><code>astro:server:setup</code></a></p>
<p><strong>Next hook:</strong> <a href="#astroserverdone"><code>astro:server:done</code></a></p>
<p><strong>When:</strong> Just after the server’s <code>listen()</code> event has fired.</p>
<p><strong>Why:</strong> To intercept network requests at the specified address. If you intend to use this address for middleware, consider using <code>astro:server:setup</code> instead.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:server:start'?: (options: { address: AddressInfo }) => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="address-option"><code>address</code> option</h4>
<p><a href="#address-option">Section titled address option</a>
<strong>Type:</strong> <a href="https://microsoft.github.io/PowerBI-JavaScript/interfaces/_node_modules__types_node_net_d_._net_.addressinfo.html"><code>AddressInfo</code></a></p>
<p>The address, family and port number supplied by the <a href="https://nodejs.org/api/net.html">Node.js Net module</a>.</p>
<h3 id="astroserverdone"><code>astro:server:done</code></h3>
<p><a href="#astroserverdone">Section titled astro:server:done</a>
<strong>Previous hook:</strong> <a href="#astroserverstart"><code>astro:server:start</code></a></p>
<p><strong>When:</strong> Just after the dev server is closed.</p>
<p><strong>Why:</strong> To run any cleanup events you may trigger during the <code>astro:server:setup</code> or <code>astro:server:start</code> hooks.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:server:done'?: () => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="astrobuildstart"><code>astro:build:start</code></h3>
<p><a href="#astrobuildstart">Section titled astro:build:start</a>
<strong>Previous hook:</strong> <a href="#astroconfigdone"><code>astro:config:done</code></a></p>
<p><strong>Next hook:</strong> <a href="#astrobuildsetup"><code>astro:build:setup</code></a></p>
<p><strong>When:</strong> After the <code>astro:config:done</code> event, but before the production build begins.</p>
<p><strong>Why:</strong> To set up any global objects or clients needed during a production build. This can also extend the build configuration options in the <a href="/en/reference/adapter-reference/">adapter API</a>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:build:start'?: () => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="astrobuildsetup"><code>astro:build:setup</code></h3>
<p><a href="#astrobuildsetup">Section titled astro:build:setup</a>
<strong>Previous hook:</strong> <a href="#astrobuildstart"><code>astro:build:start</code></a></p>
<p><strong>Next hook:</strong> <a href="#astrobuildssr"><code>astro:build:ssr</code></a></p>
<p><strong>When:</strong> After the <code>astro:build:start</code> hook, runs immediately before the build.</p>
<p><strong>Why:</strong> At this point, the Vite config for the build has been completely constructed, this is your final chance to modify it. This can be useful for example to overwrite some defaults. If you’re not sure whether you should use this hook or <code>astro:build:start</code>, use <code>astro:build:start</code> instead.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:build:setup'?: (options: {  vite: ViteConfigWithSSR;  pages: Map&#x3C;string, PageBuildData>;  target: 'client' | 'server';}) => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="astrobuildgenerated"><code>astro:build:generated</code></h3>
<p><a href="#astrobuildgenerated">Section titled astro:build:generated</a>
<strong>Previous hook:</strong> <a href="#astrobuildsetup"><code>astro:build:setup</code></a></p>
<p><strong>When:</strong> After a static production build has finished generating routes and assets.</p>
<p><strong>Why:</strong> To access generated routes and assets <strong>before</strong> build artifacts are cleaned up. This is a very uncommon use case. We recommend using <a href="#astrobuilddone"><code>astro:build:done</code></a> unless you really need to access the generated files before cleanup.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:build:generated'?: (options: { dir: URL }) => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="astrobuildssr"><code>astro:build:ssr</code></h3>
<p><a href="#astrobuildssr">Section titled astro:build:ssr</a>
<strong>Previous hook:</strong> <a href="#astrobuildsetup"><code>astro:build:setup</code></a></p>
<p><strong>When:</strong> After a production SSR build has completed.</p>
<p><strong>Why:</strong> To access the SSR manifest and map of the emitted entry points. This is useful when creating custom SSR builds in plugins or integrations.</p>
<ul>
<li><code>entryPoints</code> maps a page route to the physical file emitted after the build;</li>
<li><code>middlewareEntryPoint</code> is the file system path of the middleware file;</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:build:ssr'?: (options: {    manifest: SerializedSSRManifest,    entryPoints: Map&#x3C;RouteData, URL>,    middlewareEntryPoint: URL}) => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="astrobuilddone"><code>astro:build:done</code></h3>
<p><a href="#astrobuilddone">Section titled astro:build:done</a>
<strong>Previous hook:</strong> <a href="#astrobuildssr"><code>astro:build:ssr</code></a></p>
<p><strong>When:</strong> After a production build (SSG or SSR) has completed.</p>
<p><strong>Why:</strong> To access generated routes and assets for extension (ex. copy content into the generated <code>/assets</code> directory). If you plan to transform generated assets, we recommend exploring the <a href="https://vite.dev/guide/api-plugin.html">Vite Plugin API</a> and <a href="#updateconfig-option">configuring via <code>astro:config:setup</code></a> instead.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:build:done'?: (options: { dir: URL; routes: RouteData[], pages: { pathname: string }[] }) => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="dir-option"><code>dir</code> option</h4>
<p><a href="#dir-option">Section titled dir option</a>
<strong>Type:</strong> <a href="https://developer.mozilla.org/en-US/docs/Web/API/URL"><code>URL</code></a></p>
<p>A URL path to the build output directory. Note that if you need a valid absolute path string, you should use Node’s built-in <a href="https://nodejs.org/api/url.html#urlfileurltopathurl"><code>fileURLToPath</code></a> utility.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { writeFile } from 'node:fs/promises';import { fileURLToPath } from 'node:url';</span></span>
<span class="line"><span>export default function myIntegration() {  return {    hooks: {      'astro:build:done': async ({ dir }) => {        const metadata = await getIntegrationMetadata();        // Use fileURLToPath to get a valid, cross-platform absolute path string        const outFile = fileURLToPath(new URL('./my-integration.json', dir));        await writeFile(outFile, JSON.stringify(metadata));      }    }  }}</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="routes-option"><code>routes</code> option</h4>
<p><a href="#routes-option">Section titled routes option</a>
<strong>Type:</strong> <a href="#routedata-type-reference"><code>RouteData[]</code></a></p>
<p>A list of all generated routes alongside their associated metadata.</p>
<p>You can reference the full <code>RouteData</code> type below, but the most common properties are:</p>
<ul>
<li><code>component</code> - the input file path relative to the project root</li>
<li><code>pathname</code> - the output file URL (undefined for routes using <code>[dynamic]</code> and <code>[...spread]</code> params)</li>
</ul>
<h5 id="routedata-type-reference"><code>RouteData</code> type reference</h5>
<p><a href="#routedata-type-reference">Section titled RouteData type reference</a></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>interface RouteData {  /** Whether a given route is an HTML page or non-HTML endpoint */  type: 'page' | 'endpoint';  /** Source component URL */  component: string;  /**   * Output URL pathname where this route will be served   * note: will be undefined for [dynamic] and [...spread] routes   */  pathname?: string;  /**   * regex used for matching an input URL against a requested route   * ex. "[fruit]/about.astro" will generate the pattern: /^\/([^/]+?)\/about\/?$/   * where pattern.test("banana/about") is "true"   */  pattern: RegExp;  /**   * Dynamic and spread route params   * ex. "/pages/[lang]/[..slug].astro" will output the params ['lang', '...slug']   */  params: string[];  /**   * Similar to the "params" field, but with more associated metadata   * ex. "/pages/[lang]/index.astro" will output the segments   * [[ { content: 'lang', dynamic: true, spread: false } ]]   */  segments: { content: string; dynamic: boolean; spread: boolean; }[][];  /**   * Function to render component in-place from a set of input data.   * This is typically for internal use, so call with caution!   */  generate: (data?: any) => string;}</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="pages-option"><code>pages</code> option</h4>
<p><a href="#pages-option">Section titled pages option</a>
<strong>Type:</strong> <code>{ pathname: string }[]</code></p>
<p>A list of all generated pages. It is an object with one property.</p>
<ul>
<li><code>pathname</code> - the finalized path of the page.</li>
</ul>
<h3 id="astroroutesetup"><code>astro:route:setup</code></h3>
<p><a href="#astroroutesetup">Section titled astro:route:setup</a></p>
<p><strong>Added in:</strong>
<code>astro@4.14.0</code></p>
<p><strong>When:</strong> In <code>astro dev</code>, whenever a route is requested. In <code>astro build</code>, while bundling and transforming a route file.</p>
<p><strong>Why:</strong> To set options for a route at build or request time, such as enabling <a href="/en/guides/server-side-rendering/#opting-in-to-pre-rendering-in-server-mode">on-demand server rendering</a>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>'astro:route:setup'?: (options: { route: RouteOptions }) => void | Promise&#x3C;void>;</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="route-option"><code>route</code> option</h4>
<p><a href="#route-option">Section titled route option</a>
<strong>Type:</strong> <code>RouteOptions</code></p>
<p>An object with a <code>component</code> property to identify the route and the following additional values to allow you to configure the generated route: <code>prerender</code>.</p>
<p>The <code>component</code> property is a readonly string path relative to the project root, e.g <code>"src/pages/blog/[slug].astro"</code>.</p>
<h5 id="routeprerender"><code>route.prerender</code></h5>
<p><a href="#routeprerender">Section titled route.prerender</a>
<strong>Type:</strong> <code>boolean</code></p>
<p><strong>Default:</strong> <code>undefined</code></p>
<p><strong>Added in:</strong>
<code>astro@4.14.0</code></p>
<p>The <code>prerender</code> property is used to configure <a href="/en/guides/server-side-rendering/#opting-in-to-pre-rendering-in-server-mode">on-demand server rendering</a> for a route. If the route file contains an explicit <code>export const prerender</code> value, the value will be used as the default instead of <code>undefined</code>.</p>
<p>astro.config.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineConfig } from 'astro/config';</span></span>
<span class="line"><span>export default defineConfig({  integrations: [setPrerender()],});</span></span>
<span class="line"><span>function setPrerender() {  return {    name: 'set-prerender',    hooks: {      'astro:route:setup': ({ route }) => {        if (route.component.endsWith('/blog/[slug].astro')) {          route.prerender = true;        }      },    },  };}</span></span>
<span class="line"><span></span></span></code></pre>
<p>If the final value after running all the hooks is <code>undefined</code>, the route will fall back to a prerender default based on the <a href="/en/reference/configuration-reference/#output"><code>output</code> option</a>: prerendered for <code>hybrid</code> mode, and on-demand rendered for <code>server</code> mode.</p>
<h3 id="custom-hooks">Custom hooks</h3>
<p><a href="#custom-hooks">Section titled Custom hooks</a>
Custom hooks can be added to integrations by extending the <code>IntegrationHooks</code> interface through <a href="https://www.typescriptlang.org/docs/handbook/declaration-merging.html#global-augmentation">global augmentation</a>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>declare global {  namespace Astro {    export interface IntegrationHook {      'your:hook': (params: YourHookParameters) => Promise&#x3C;void>    }  }}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Astro reserves the <code>astro:</code> prefix for future built-in hooks. Please choose a different prefix when naming your custom hook.</p>
<h3 id="hookparameters"><code>HookParameters</code></h3>
<p><a href="#hookparameters">Section titled HookParameters</a>
You can get the type of a hook’s arguments by passing the hook’s name to the <code>HookParameters</code> utility type. In the following example, a function’s <code>options</code> argument is typed to match the parameters of the <code>astro:config:setup</code> hook:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import type { HookParameters } from 'astro';</span></span>
<span class="line"><span>function mySetup(options: HookParameters&#x3C;'astro:config:setup'>) {  options.updateConfig({ /* ... */ });}</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="allow-installation-with-astro-add">Allow installation with <code>astro add</code></h2>
<p><a href="#allow-installation-with-astro-add">Section titled Allow installation with astro add</a>
<a href="/en/reference/cli-reference/#astro-add">The <code>astro add</code> command</a> allows users to easily add integrations and adapters to their project. If you want <em>your</em> integration to be installable with this tool, <strong>add <code>astro-integration</code> to the <code>keywords</code> field in your <code>package.json</code></strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>{  "name": "example",  "keywords": ["astro-integration"],}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Once you <a href="https://docs.npmjs.com/cli/v8/commands/npm-publish">publish your integration to npm</a>, running <code>astro add example</code> will install your package with any peer dependencies specified in your <code>package.json</code>. This will also apply your integration to the user’s <code>astro.config</code> like so:</p>
<p>astro.config.mjs</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineConfig } from 'astro/config'; import example from 'example';</span></span>
<span class="line"><span>export default defineConfig({  integrations: [example()],})</span></span>
<span class="line"><span></span></span></code></pre>
<p>Caution</p>
<p>This assumes your integration definition is 1) a <code>default</code> export and 2) a function. Ensure this is true before adding the <code>astro-integration</code> keyword!</p>
<h2 id="astrointegrationlogger"><code>AstroIntegrationLogger</code></h2>
<p><a href="#astrointegrationlogger">Section titled AstroIntegrationLogger</a>
An instance of the Astro logger, useful to write logs. This logger uses the same <a href="/en/reference/cli-reference/#--verbose">log level</a>
configured via CLI.</p>
<p><strong>Methods available</strong> to write to terminal:</p>
<ul>
<li><code>logger.info("Message")</code>;</li>
<li><code>logger.warn("Message")</code>;</li>
<li><code>logger.error("Message")</code>;</li>
<li><code>logger.debug("Message")</code>;</li>
</ul>
<p>All the messages are prepended with a label that has the same value of the integration.</p>
<p>integration.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import type { AstroIntegration } from "astro";export function formatIntegration(): AstroIntegration {    return {        name: "astro-format",        hooks: {            "astro:build:done": ({ logger }) => {                // do something                logger.info("Integration ready.");            }        }    }}</span></span>
<span class="line"><span></span></span></code></pre>
<p>The example above will log a message that includes the provided <code>info</code> message:</p>
<p>Terminal window</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[astro-format] Integration ready.</span></span>
<span class="line"><span></span></span></code></pre>
<p>To log some messages with a different label, use the <code>.fork</code> method to specify an alternative to the default <code>name</code>:</p>
<p>integration.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import type { AstroIntegration } from "astro";export function formatIntegration(): AstroIntegration {    return {        name: "astro-format",        hooks: {            "astro:config:done": ({ logger }) => {                // do something                logger.info("Integration ready.");            },            "astro:build:done": ({ logger }) => {                const buildLogger = logger.fork("astro-format/build");                // do something                buildLogger.info("Build finished.")            }        }    }}</span></span>
<span class="line"><span></span></span></code></pre>
<p>The example above will produce logs with <code>[astro-format]</code> by default, and <code>[astro-format/build]</code> when specified:</p>
<p>Terminal window</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[astro-format] Integration ready.[astro-format/build] Build finished.</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="integration-ordering">Integration Ordering</h2>
<p><a href="#integration-ordering">Section titled Integration Ordering</a>
All integrations are run in the order that they are configured. For instance, for the array <code>[react(), svelte()]</code> in a user’s <code>astro.config.*</code>, <code>react</code> will run before <code>svelte</code>.</p>
<p>Your integration should ideally run in any order. If this isn’t possible, we recommend documenting that your integration needs to come first or last in your user’s <code>integrations</code> configuration array.</p>
<h2 id="combine-integrations-into-presets">Combine integrations into presets</h2>
<p><a href="#combine-integrations-into-presets">Section titled Combine integrations into presets</a>
An integration can also be written as a collection of multiple, smaller integrations. We call these collections <strong>presets.</strong> Instead of creating a factory function that returns a single integration object, a preset returns an <em>array</em> of integration objects. This is useful for building complex features out of multiple integrations.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>integrations: [  // Example: where examplePreset() returns: [integrationOne, integrationTwo, ...etc]  examplePreset()]</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="community-resources">Community Resources</h2>
<p><a href="#community-resources">Section titled Community Resources</a></p>
<ul>
<li><a href="https://www.freecodecamp.org/news/how-to-use-the-astro-ui-framework/#chapter-8-build-your-own-astro-integrations-1">Build your own Astro Integrations</a> - by Emmanuel Ohans on FreeCodeCamp</li>
<li><a href="https://github.com/florian-lefebvre/astro-integration-template">Astro Integration Template</a> - by Florian Lefebvre on GitHub</li>
</ul>
<p>Reference</p> </div> <div class="prose-a:no-underline flex gap-2"> <span class="badge badge-outline badge-md"> <a href="/tags/guide/1/">guide</a> </span><span class="badge badge-outline badge-md"> <a href="/tags/Python/1/">Python</a> </span><span class="badge badge-outline badge-md"> <a href="/tags/Sass/1/">Sass</a> </span> </div> <div class="mt-4 flex justify-between"> <small>Publish on <span class="font-weight-bold">2024-02-04</span>，Update on <span class="font-weight-bold">2025-01-09</span></small> </div> </article> <div class="mt-12"> <div class="grid grid-cols-1 gap-4 md:grid-cols-3"> <div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/manage-your-content-guides-markdown-content/"> <picture> <source srcset="/_astro/photo-1472377723522-4768db9c41ce_cr2OL.avif 392w, /_astro/photo-1472377723522-4768db9c41ce_ZY6gfW.avif 700w, /_astro/photo-1472377723522-4768db9c41ce_1nCPx9.avif 980w, /_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif" srcset="/_astro/photo-1472377723522-4768db9c41ce_cr2OL.avif 392w, /_astro/photo-1472377723522-4768db9c41ce_ZY6gfW.avif 700w, /_astro/photo-1472377723522-4768db9c41ce_1nCPx9.avif 980w, /_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif 1960w" alt="white and brown concrete house near trees at daytime" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">astro-build</span><span class="badge badge-outline">Go</span><span class="badge badge-outline">Css</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-02-21</span></p> <h2 class="card-title">Markdown in Astro</h2> </div> </a> </div><div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/welcome-world-guides-deploy/"> <picture> <source srcset="/_astro/photo-1480074568708-e7b720bb3f09_Z2vlXMC.avif 392w, /_astro/photo-1480074568708-e7b720bb3f09_1nhPUA.avif 700w, /_astro/photo-1480074568708-e7b720bb3f09_Z1kab5f.avif 980w, /_astro/photo-1480074568708-e7b720bb3f09_vUEOm.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1480074568708-e7b720bb3f09_vUEOm.avif" srcset="/_astro/photo-1480074568708-e7b720bb3f09_Z2vlXMC.avif 392w, /_astro/photo-1480074568708-e7b720bb3f09_1nhPUA.avif 700w, /_astro/photo-1480074568708-e7b720bb3f09_Z1kab5f.avif 980w, /_astro/photo-1480074568708-e7b720bb3f09_vUEOm.avif 1960w" alt="white house under maple trees" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">guide</span><span class="badge badge-outline">CSharp</span><span class="badge badge-outline">Sass</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-02-16</span></p> <h2 class="card-title">Deploy your Astro Site</h2> </div> </a> </div><div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/core-concepts-concepts-islands/"> <picture> <source srcset="/_astro/photo-1483366774565-c783b9f70e2c_jGYEQ.avif 392w, /_astro/photo-1483366774565-c783b9f70e2c_ZQPjpR.avif 700w, /_astro/photo-1483366774565-c783b9f70e2c_1uSMne.avif 980w, /_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif" srcset="/_astro/photo-1483366774565-c783b9f70e2c_jGYEQ.avif 392w, /_astro/photo-1483366774565-c783b9f70e2c_ZQPjpR.avif 700w, /_astro/photo-1483366774565-c783b9f70e2c_1uSMne.avif 980w, /_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif 1960w" alt="worm's-eye view photography of concrete building" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">tutorial</span><span class="badge badge-outline">CSharp</span><span class="badge badge-outline">Less</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-02-12</span></p> <h2 class="card-title">Astro Islands</h2> </div> </a> </div> </div> </div> </main>  </main> <footer class="mx-auto mt-auto w-full max-w-[85rem] py-10"> <nav class="mx-auto w-full max-w-[85rem] px-4" aria-label="Footer"> <div class="flex flex-col items-center sm:flex-row sm:justify-between"> <div id="navbar-alignment" class="internal-links sm:order-2"> <div class="mt-2 flex flex-row gap-5 sm:mt-0 sm:flex-row sm:items-center sm:ps-5"> <a href="/posts/core-concepts-concepts-why-astro/" class="inline-flex gap-x-2 text-sm"> Astro </a><a href="/posts/assets-guides-styling/" class="inline-flex gap-x-2 text-sm"> Styling </a><a href="/tags/" class="inline-flex gap-x-2 text-sm"> Tags </a> </div> </div> <div class="mt-2 flex flex-wrap gap-2 sm:order-3 sm:mb-0 sm:gap-0"> <button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="/rss.xml" class="absolute inset-0 z-10" aria-label="RSS"></a> <i class="i-tabler-rss icon-base"></i> </button><button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="https://twitter.com/astrodotbuild" class="absolute inset-0 z-10" aria-label="Twitter"></a> <i class="i-tabler-brand-twitter icon-base"></i> </button><button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="https://github.com/isooosi" class="absolute inset-0 z-10" aria-label="GitHub"></a> <i class="i-tabler-brand-github icon-base"></i> </button> </div> <div class="mt-2 sm:order-1 sm:mb-0"> <a class="flex-none text-sm" href="/" aria-label="Brand">AstroMelody &copy; 2025</a> </div> </div> </nav> </footer> </body></html>