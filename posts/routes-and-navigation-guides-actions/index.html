<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.7"><!-- Canonical URL --><link rel="canonical" href="https://10ta.github.io/posts/routes-and-navigation-guides-actions/"><!-- Sitemap --><link rel="sitemap" href="/sitemap-index.xml"><!-- Primary Meta Tags --><title>Actions</title><meta name="title" content="Actions"><meta name="description" content="Learn how to create type-safe server functions you can call from anywhere."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://10ta.github.io/posts/routes-and-navigation-guides-actions/"><meta property="og:title" content="Actions"><meta property="og:description" content="Learn how to create type-safe server functions you can call from anywhere."><meta property="og:image" content="https://10ta.github.io/blog-placeholder-1.avif"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://10ta.github.io/posts/routes-and-navigation-guides-actions/"><meta property="twitter:title" content="Actions"><meta property="twitter:description" content="Learn how to create type-safe server functions you can call from anywhere."><meta property="twitter:image" content="https://10ta.github.io/blog-placeholder-1.avif"><link rel="stylesheet" href="/_astro/_page_.Bdwf1GY7.css"><script type="module" src="/_astro/hoisted.CPfS8Ggc.js"></script>
<script type="module" src="/_astro/page.DTIbhfSr.js"></script>
<script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.10.2 - MIT builder.io */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,d,l,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(l=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(v,1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.10.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<l.length;n++)(o=r.createElement("script")).innerHTML=l[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(d)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="flex flex-col min-h-screen mx-auto max-w-6xl px-4 dark:prose-invert sm:px-6 lg:px-8"> <header class="z-50 flex w-full flex-wrap py-7 md:flex-nowrap md:justify-start"> <nav class="relative mx-auto flex w-full max-w-7xl basis-full flex-wrap items-center px-4" aria-label="Global"> <div class=""> <a class="flex-none text-xl font-semibold" href="/" aria-label="Astroverse"> AstroMelody </a> </div> <div class="ms-auto flex items-center gap-x-2 py-1"> <a class="inline-flex items-center gap-x-2 rounded-xl border border-transparent px-3 py-2 text-sm font-medium disabled:pointer-events-none disabled:opacity-50" href="/search/" href="/search/"> <i class="icon-base i-tabler-search"></i> </a> <div class="dropdown dropdown-end"> <div tabindex="0" role="button" class="flex size-[38px] items-center justify-center rounded-xl text-sm font-semibold"> <i class="icon-base i-tabler-category-2"></i> </div> <ul tabindex="0" class="menu dropdown-content z-[1] w-52 rounded-box bg-base-100 p-2 shadow"> <li> <a href="/category/One/1/" class="px-4 py-3 font-medium"> One </a> </li><li> <a href="/category/Two/1/" class="px-4 py-3 font-medium"> Two </a> </li><li> <a href="/category/Three/1/" class="px-4 py-3 font-medium"> Three </a> </li> </ul> </div> <label class="swap swap-rotate rounded-xl px-3 py-2 text-sm"> <!-- this hidden checkbox controls the state --> <input type="checkbox" class="theme-controller" data-unchecked-value="corporate" value="halloween"> <!-- sun icon --> <i class="icon-base swap-off i-tabler-sun-filled"></i> <!-- moon icon --> <i class="icon-base swap-on i-tabler-moon-filled"></i> </label> </div> </nav> </header> <!-- Save theme to localStorage --> <script>
  const lightTheme =  document.querySelector('.theme-controller')?.getAttribute('data-unchecked-value');
  // ☝️ This script prevent the FART effect.
  if (localStorage.getItem("theme") === null) {
    document.documentElement.setAttribute("data-theme", lightTheme);
  } else
    document.documentElement.setAttribute(
      "data-theme",
      localStorage.getItem("theme"),
    );
  // "theme" LocalStorage value is set by the package to remember user preference.
  // The value is checked and applyed before rendering anything.
</script>  <!-- 内容区域，确保其动态调整高度 --> <main class="flex-grow">  <main> <article class="prose mx-auto dark:prose-invert"> <div class="prose-h1 text-center"> <h1>Actions</h1> </div> <div> <picture> <source srcset="/_astro/photo-1514539079130-25950c84af65_ZG1oHX.avif 392w, /_astro/photo-1514539079130-25950c84af65_Z1RyHNG.avif 700w, /_astro/photo-1514539079130-25950c84af65_uanYp.avif 980w, /_astro/photo-1514539079130-25950c84af65_1abTbp.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1514539079130-25950c84af65_1abTbp.avif" srcset="/_astro/photo-1514539079130-25950c84af65_ZG1oHX.avif 392w, /_astro/photo-1514539079130-25950c84af65_Z1RyHNG.avif 700w, /_astro/photo-1514539079130-25950c84af65_uanYp.avif 980w, /_astro/photo-1514539079130-25950c84af65_1abTbp.avif 1960w" alt="closeup photo of castle with mist" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> </div> <div> <p><strong>Added in:</strong>
<code>astro@4.15</code></p>
<p>Astro Actions allow you to define and call backend functions with type-safety. Actions perform data fetching, JSON parsing, and input validation for you. This can greatly reduce the amount of boilerplate needed compared to using an <a href="/en/guides/endpoints/">API endpoint</a>.</p>
<p>Use actions instead of API endpoints for seamless communication between your client and server code and to:</p>
<ul>
<li>Automatically validate JSON and form data inputs using <a href="https://zod.dev/?id=primitives">Zod validation</a>.</li>
<li>Generate type-safe functions to call your backend from the client and even <a href="#call-actions-from-an-html-form-action">from HTML form actions</a>. No need for manual <code>fetch()</code> calls.</li>
<li>Standardize backend errors with the <a href="/en/reference/modules/astro-actions/#actionerror"><code>ActionError</code></a> object.</li>
</ul>
<h2 id="basic-usage">Basic usage</h2>
<p><a href="#basic-usage">Section titled Basic usage</a>
Actions are defined in a <code>server</code> object exported from <code>src/actions/index.ts</code>:</p>
<p>src/actions/index.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineAction } from 'astro:actions';import { z } from 'astro:schema';</span></span>
<span class="line"><span>export const server = {  myAction: defineAction({ /* ... */ })}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Your actions are available as functions from the <code>astro:actions</code> module. Import <code>actions</code> and call them client-side within a <a href="/en/guides/framework-components/">UI framework component</a>, <a href="#call-actions-from-an-html-form-action">a form POST request</a>, or by using a <code>&#x3C;script></code> tag in an Astro component.</p>
<p>When you call an action, it returns an object with either <code>data</code> containing the JSON-serialized result, or <code>error</code> containing thrown errors.</p>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>------</span></span>
<span class="line"><span>&#x3C;script>import { actions } from 'astro:actions';</span></span>
<span class="line"><span>async () => {  const { data, error } = await actions.myAction({ /* ... */ });}&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="write-your-first-action">Write your first action</h3>
<p><a href="#write-your-first-action">Section titled Write your first action</a>
Follow these steps to define an action and call it in a <code>script</code> tag in your Astro page.</p>
<ol>
<li>Create a <code>src/actions/index.ts</code> file and export a <code>server</code> object.</li>
</ol>
<p>src/actions/index.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export const server = {  // action declarations}</span></span>
<span class="line"><span></span></span></code></pre>
<ol start="2">
<li>Import the <code>defineAction()</code> utility from <code>astro:actions</code>, and the <code>z</code> object from <code>astro:schema</code>.</li>
</ol>
<p>src/actions/index.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineAction } from 'astro:actions';import { z } from 'astro:schema';</span></span>
<span class="line"><span> export const server = {  // action declarations}</span></span>
<span class="line"><span></span></span></code></pre>
<ol start="3">
<li>Use the <code>defineAction()</code> utility to define a <code>getGreeting</code> action. The <code>input</code> property will be used to validate input parameters with a <a href="https://zod.dev">Zod</a> schema and the <code>handler()</code> function includes the backend logic to run on the server.</li>
</ol>
<p>src/actions/index.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineAction } from 'astro:actions';import { z } from 'astro:schema';</span></span>
<span class="line"><span>export const server = {  getGreeting: defineAction({    input: z.object({      name: z.string(),    }),    handler: async (input) => {      return `Hello, ${input.name}!`    }  })}</span></span>
<span class="line"><span></span></span></code></pre>
<ol start="4">
<li>Create an Astro component with a button that will fetch a greeting using your <code>getGreeting</code> action when clicked.</li>
</ol>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>------</span></span>
<span class="line"><span>&#x3C;button>Get greeting&#x3C;/button></span></span>
<span class="line"><span>&#x3C;script>const button = document.querySelector('button');button?.addEventListener('click', async () => {  // Show alert pop-up with greeting from action});&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<ol start="5">
<li>To use your action, import <code>actions</code> from <code>astro:actions</code> and then call <code>actions.getGreeting()</code> in the click handler. The <code>name</code> option will be sent to your action’s <code>handler()</code> on the server and, if there are no errors, the result will be available as the <code>data</code> property.</li>
</ol>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>------</span></span>
<span class="line"><span>&#x3C;button>Get greeting&#x3C;/button></span></span>
<span class="line"><span>&#x3C;script>import { actions } from 'astro:actions';</span></span>
<span class="line"><span>const button = document.querySelector('button');button?.addEventListener('click', async () => {  // Show alert pop-up with greeting from action  const { data, error } = await actions.getGreeting({ name: "Houston" });  if (!error) alert(data);})&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<p>See the full Actions API documentation for details on <a href="/en/reference/modules/astro-actions/#defineaction"><code>defineAction()</code></a> and its properties.</p>
<h2 id="organizing-actions">Organizing actions</h2>
<p><a href="#organizing-actions">Section titled Organizing actions</a>
All actions in your project must be exported from the <code>server</code> object in the <code>src/actions/index.ts</code> file. You can define actions inline or you can move action definitions to separate files and import them. You can even group related functions in nested objects.</p>
<p>For example, to colocate all of your user actions, you can create a <code>src/actions/user.ts</code> file and nest the definitions of both <code>getUser</code> and <code>createUser</code> inside a single <code>user</code> object.</p>
<p>src/actions/user.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineAction } from 'astro:actions';</span></span>
<span class="line"><span>export const user = {  getUser: defineAction(/* ... */),  createUser: defineAction(/* ... */),}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Then, you can import this <code>user</code> object into your <code>src/actions/index.ts</code> file and add it as a top-level key to the <code>server</code> object alongside any other actions:</p>
<p>src/actions/index.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { user } from './user';</span></span>
<span class="line"><span>export const server = {  myAction: defineAction({ /* ... */ }),  user,}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Now, all of your user actions are callable from the <code>actions.user</code> object:</p>
<ul>
<li><code>actions.user.getUser()</code></li>
<li><code>actions.user.createUser()</code></li>
</ul>
<h2 id="handling-returned-data">Handling returned data</h2>
<p><a href="#handling-returned-data">Section titled Handling returned data</a>
Actions return an object containing either <code>data</code> with the type-safe return value of your <code>handler()</code>, or an <code>error</code> with any backend errors. Errors may come from validation errors on the <code>input</code> property or thrown errors within the <code>handler()</code>.</p>
<h3 id="checking-for-errors">Checking for errors</h3>
<p><a href="#checking-for-errors">Section titled Checking for errors</a>
It’s best to check if an <code>error</code> is present before using the <code>data</code> property. This allows you to handle errors in advance and ensures <code>data</code> is defined without an <code>undefined</code> check.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>const { data, error } = await actions.example();</span></span>
<span class="line"><span>if (error) {  // handle error cases  return;}// use `data`</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="accessing-data-directly-without-an-error-check">Accessing <code>data</code> directly without an error check</h3>
<p><a href="#accessing-data-directly-without-an-error-check">Section titled Accessing data directly without an error check</a>
To skip error handling, for example while prototyping or using a library that will catch errors for you, use the <code>.orThrow()</code> property on your action call to throw errors instead of returning an <code>error</code>. This will return the action’s <code>data</code> directly.</p>
<p>This example calls a <code>likePost()</code> action that returns the updated number of likes as a <code>number</code> from the action <code>handler</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>const updatedLikes = await actions.likePost.orThrow({ postId: 'example' });//    ^ type: number</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="handling-backend-errors-in-your-action">Handling backend errors in your action</h3>
<p><a href="#handling-backend-errors-in-your-action">Section titled Handling backend errors in your action</a>
You can use the provided <code>ActionError</code> to throw an error from your action <code>handler()</code>, such as “not found” when a database entry is missing, or “unauthorized” when a user is not logged in. This has two main benefits over returning <code>undefined</code>:</p>
<ul>
<li>You can set a status code like <code>404 - Not found</code> or <code>401 - Unauthorized</code>. This improves debugging errors in both development and in production by letting you see the status code of each request.</li>
<li>In your application code, all errors are passed to the <code>error</code> object on an action result. This avoids the need for <code>undefined</code> checks on data, and allows you to display targeted feedback to the user depending on what went wrong.</li>
</ul>
<h4 id="creating-an-actionerror">Creating an <code>ActionError</code></h4>
<p><a href="#creating-an-actionerror">Section titled Creating an ActionError</a>
To throw an error, import the <code>ActionError()</code> class from the <code>astro:actions</code> module. Pass it a human-readable status <code>code</code> (e.g. <code>"NOT_FOUND"</code> or <code>"BAD_REQUEST"</code>), and an optional <code>message</code> to provide further information about the error.</p>
<p>This example throws an error from a <code>likePost</code> action when a user is not logged in, after checking a hypothetical “user-session” cookie for authentication:</p>
<p>src/actions/index.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineAction, ActionError } from "astro:actions";import { z } from "astro:schema";</span></span>
<span class="line"><span>export const server = {  likePost: defineAction({    input: z.object({ postId: z.string() }),    handler: async (input, ctx) => {      if (!ctx.cookies.has('user-session')) {        throw new ActionError({          code: "UNAUTHORIZED",          message: "User must be logged in.",        });      }      // Otherwise, like the post    },  }),};</span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="handling-an-actionerror">Handling an <code>ActionError</code></h4>
<p><a href="#handling-an-actionerror">Section titled Handling an ActionError</a>
To handle this error, you can call the action from your application and check whether an <code>error</code> property is present. This property will be of type <code>ActionError</code> and will contain your <code>code</code> and <code>message</code>.</p>
<p>In the following example, a <code>LikeButton.tsx</code> component calls the <code>likePost()</code> action when clicked. If an authentication error occurs, the <code>error.code</code> attribute is used to determine whether to display a login link:</p>
<p>src/components/LikeButton.tsx</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { actions } from 'astro:actions';import { useState } from 'preact/hooks';</span></span>
<span class="line"><span>export function LikeButton({ postId }: { postId: string }) {  const [showLogin, setShowLogin] = useState(false);  return (    &#x3C;>      {        showLogin &#x26;&#x26; &#x3C;a href="/signin">Log in to like a post.&#x3C;/a>      }      &#x3C;button onClick={async () => {        const { data, error } = await actions.likePost({ postId });        if (error?.code === 'UNAUTHORIZED') setShowLogin(true);        // Early return for unexpected errors        else if (error) return;        // update likes      }}>        Like      &#x3C;/button>    &#x3C;/>  )}</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="handling-client-redirects">Handling client redirects</h3>
<p><a href="#handling-client-redirects">Section titled Handling client redirects</a>
When calling actions from the client, you can integrate with a client-side library like <code>react-router</code>, or you can use Astro’s <a href="/en/guides/view-transitions/#trigger-navigation"><code>navigate()</code> function</a> to redirect to a new page when an action succeeds.</p>
<p>This example navigates to the homepage after a <code>logout</code> action returns successfully:</p>
<p>src/pages/LogoutButton.tsx</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { actions } from 'astro:actions';import { navigate } from 'astro:transitions/client';</span></span>
<span class="line"><span>export function LogoutButton() {  return (    &#x3C;button onClick={async () => {      const { error } = await actions.logout();      if (!error) navigate('/');    }}>      Logout    &#x3C;/button>  );}</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="accepting-form-data-from-an-action">Accepting form data from an action</h2>
<p><a href="#accepting-form-data-from-an-action">Section titled Accepting form data from an action</a>
Actions accept JSON data by default. To accept form data from an HTML form, set <code>accept: 'form'</code> in your <code>defineAction()</code> call:</p>
<p>src/actions/index.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineAction } from 'astro:actions';import { z } from 'astro:schema';</span></span>
<span class="line"><span>export const server = {  comment: defineAction({    accept: 'form',    input: z.object(/* ... */),    handler: async (input) => { /* ... */ },  })}</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="validating-form-data">Validating form data</h3>
<p><a href="#validating-form-data">Section titled Validating form data</a>
Actions will parse submitted form data to an object, using the value of each input’s <code>name</code> attribute as the object keys. For example, a form containing <code>&#x3C;input name="search"></code> will be parsed to an object like <code>{ search: 'user input' }</code>. Your action’s <code>input</code> schema will be used to validate this object.</p>
<p>To receive the raw <code>FormData</code> object in your action handler instead of a parsed object, omit the <code>input</code> property in your action definition.</p>
<p>The following example shows a validated newsletter registration form that accepts a user’s email and requires a “terms of service” agreement checkbox.</p>
<ol>
<li>Create an HTML form component with unique <code>name</code> attributes on each input:</li>
</ol>
<p>src/components/Newsletter.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;form>  &#x3C;label for="email">E-mail&#x3C;/label>  &#x3C;input id="email" required type="email" name="email" />  &#x3C;label>    &#x3C;input required type="checkbox" name="terms">    I agree to the terms of service  &#x3C;/label>  &#x3C;button>Sign up&#x3C;/button>&#x3C;/form></span></span>
<span class="line"><span></span></span></code></pre>
<ol start="2">
<li>Define a <code>newsletter</code> action to handle the submitted form. Validate the <code>email</code> field using the <code>z.string().email()</code> validator, and the <code>terms</code> checkbox using <code>z.boolean()</code>:</li>
</ol>
<p>src/actions/index.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineAction } from 'astro:actions';import { z } from 'astro:schema';</span></span>
<span class="line"><span>export const server = {  newsletter: defineAction({    accept: 'form',    input: z.object({      email: z.string().email(),      terms: z.boolean(),    }),    handler: async ({ email, terms }) => { /* ... */ },  })}</span></span>
<span class="line"><span></span></span></code></pre>
<p>See the <a href="/en/reference/modules/astro-actions/#input-validator"><code>input</code> API reference</a> for all available form validators.
3. Add a <code>&#x3C;script></code> to the HTML form to submit the user input. This example overrides the form’s default submit behavior to call <code>actions.newsletter()</code>, and redirects to <code>/confirmation</code> using the <code>navigate()</code> function:</p>
<p>src/components/Newsletter.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;form>7 collapsed lines  &#x3C;label for="email">E-mail&#x3C;/label>  &#x3C;input id="email" required type="email" name="email" />  &#x3C;label>    &#x3C;input required type="checkbox" name="terms">    I agree to the terms of service  &#x3C;/label>  &#x3C;button>Sign up&#x3C;/button>&#x3C;/form></span></span>
<span class="line"><span>&#x3C;script>  import { actions } from 'astro:actions';  import { navigate } from 'astro:transitions/client';</span></span>
<span class="line"><span>  const form = document.querySelector('form');  form?.addEventListener('submit', async (event) => {    event.preventDefault();    const formData = new FormData(form);    const { error } = await actions.newsletter(formData);    if (!error) navigate('/confirmation');  })&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<p>See <a href="#call-actions-from-an-html-form-action">“Call actions from an HTML form action”</a> for an alternative way to submit form data.</p>
<h3 id="displaying-form-input-errors">Displaying form input errors</h3>
<p><a href="#displaying-form-input-errors">Section titled Displaying form input errors</a>
You can validate form inputs before submission using <a href="https://developer.mozilla.org/en-US/docs/Learn/Forms/Form_validation#using_built-in_form_validation">native HTML form validation attributes</a> like <code>required</code>, <code>type="email"</code>, and <code>pattern</code>. For more complex <code>input</code> validation on the backend, you can use the provided <a href="/en/reference/modules/astro-actions/#isinputerror"><code>isInputError()</code></a> utility function.</p>
<p>To retrieve input errors, use the <code>isInputError()</code> utility to check whether an error was caused by invalid input. Input errors contain a <code>fields</code> object with messages for each input name that failed to validate. You can use these messages to prompt your user to correct their submission.</p>
<p>The following example checks the error with <code>isInputError()</code>, then checks whether the error is in the email field, before finally creating a message from the errors. You can use JavaScript DOM manipulation or your preferred UI framework to display this message to users.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { actions, isInputError } from 'astro:actions';</span></span>
<span class="line"><span>const form = document.querySelector('form');const formData = new FormData(form);const { error } = await actions.newsletter(formData);if (isInputError(error)) {  // Handle input errors.  if (error.fields.email) {    const message = error.fields.email.join(', ');  }}</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="call-actions-from-an-html-form-action">Call actions from an HTML form action</h2>
<p><a href="#call-actions-from-an-html-form-action">Section titled Call actions from an HTML form action</a>
Note</p>
<p>Pages must be on-demand rendered when calling actions using a form action. <a href="/en/guides/server-side-rendering/#opting-out-of-pre-rendering-in-hybrid-mode">Ensure prerendering is disabled on the page</a> before using this API.</p>
<p>You can enable zero-JS form submissions with standard attributes on any <code>&#x3C;form></code> element. Form submissions without client-side JavaScript may be useful both as a fallback for when JavaScript fails to load, or if you prefer to handle forms entirely from the server.</p>
<p>Calling <a href="/en/reference/api-reference/#astrogetactionresult">Astro.getActionResult()</a> on the server returns the result of your form submission (<code>data</code> or <code>error</code>), and can be used to dynamically redirect, handle form errors, update the UI, and more.</p>
<p>To call an action from an HTML form, add <code>method="POST"</code> to your <code>&#x3C;form></code>, then set the form’s <code>action</code> attribute using your action, for example <code>action={actions.logout}</code>. This will set the <code>action</code> attribute to use a query string that is handled by the server automatically.</p>
<p>For example, this Astro component calls the <code>logout</code> action when the button is clicked and reloads the current page:</p>
<p>src/components/LogoutButton.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { actions } from 'astro:actions';---</span></span>
<span class="line"><span>&#x3C;form method="POST" action={actions.logout}>  &#x3C;button>Log out&#x3C;/button>&#x3C;/form></span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="redirect-on-action-success">Redirect on action success</h3>
<p><a href="#redirect-on-action-success">Section titled Redirect on action success</a>
To navigate to a different page when an action is successful without client-side JavaScript, you can prepend a path in the <code>action</code> attribute.</p>
<p>For example, <code>action={'/confirmation' + actions.newsletter}</code> will navigate to <code>/confirmation</code> when the <code>newsletter</code> action succeeds:</p>
<p>src/components/NewsletterSignup.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { actions } from 'astro:actions';---</span></span>
<span class="line"><span>&#x3C;form method="POST" action={'/confirmation' + actions.newsletter}>  &#x3C;label>E-mail &#x3C;input required type="email" name="email" />&#x3C;/label>  &#x3C;button>Sign up&#x3C;/button>&#x3C;/form></span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="dynamic-redirect-on-action-success">Dynamic redirect on action success</h4>
<p><a href="#dynamic-redirect-on-action-success">Section titled Dynamic redirect on action success</a>
If you need to decide where to redirect to dynamically, you can use an action’s result on the server. A common example is creating a product record and redirecting to the new product’s page, e.g. <code>/products/[id]</code>.</p>
<p>For example, say you have a <code>createProduct</code> action that returns the generated product id:</p>
<p>src/actions/index.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineAction } from 'astro:actions';import { z } from 'astro:schema';</span></span>
<span class="line"><span>export const server = {  createProduct: defineAction({    accept: 'form',    input: z.object({ /* ... */ }),    handler: async (input) => {      const product = await persistToDatabase(input);      return { id: product.id };    },  })}</span></span>
<span class="line"><span></span></span></code></pre>
<p>You can retrieve the action result from your Astro component by calling <code>Astro.getActionResult()</code>. This returns an object containing <code>data</code> or <code>error</code> properties when an action is called, or <code>undefined</code> if the action was not called during this request.</p>
<p>Use the <code>data</code> property to construct a URL to use with <code>Astro.redirect()</code>:</p>
<p>src/pages/products/create.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { actions } from 'astro:actions';</span></span>
<span class="line"><span>const result = Astro.getActionResult(actions.createProduct);if (result &#x26;&#x26; !result.error) {  return Astro.redirect(`/products/${result.data.id}`);}---</span></span>
<span class="line"><span>&#x3C;form method="POST" action={actions.createProduct}>  &#x3C;!--...-->&#x3C;/form></span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="handle-form-action-errors">Handle form action errors</h3>
<p><a href="#handle-form-action-errors">Section titled Handle form action errors</a>
Astro will not redirect to your <code>action</code> route when an action fails. Instead, the current page is reloaded with any errors the action returned. Calling <code>Astro.getActionResult()</code> in the Astro component containing your form gives you access to the <code>error</code> object for custom error handling.</p>
<p>The following example displays a general failure message when a <code>newsletter</code> action fails:</p>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { actions } from 'astro:actions';</span></span>
<span class="line"><span>const result = Astro.getActionResult(actions.newsletter);---</span></span>
<span class="line"><span>{result?.error &#x26;&#x26; (  &#x3C;p class="error">Unable to sign up. Please try again later.&#x3C;/p>)}&#x3C;form method="POST" action={'/confirmation' + actions.newsletter}>  &#x3C;label>    E-mail    &#x3C;input required type="email" name="email" />  &#x3C;/label>  &#x3C;button>Sign up&#x3C;/button>&#x3C;/form></span></span>
<span class="line"><span></span></span></code></pre>
<p>For more customization, you can <a href="#displaying-form-input-errors">use the <code>isInputError()</code> utility</a> to check whether an error is caused by invalid input.</p>
<p>The following example renders an error banner under the <code>email</code> input field when an invalid email is submitted:</p>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { actions, isInputError } from 'astro:actions';</span></span>
<span class="line"><span>const result = Astro.getActionResult(actions.newsletter);const inputErrors = isInputError(result?.error) ? result.error.fields : {};---</span></span>
<span class="line"><span>&#x3C;form method="POST" action={'/confirmation' + actions.newsletter}>  &#x3C;label>    E-mail    &#x3C;input required type="email" name="email" aria-describedby="error" />  &#x3C;/label>  {inputErrors.email &#x26;&#x26; &#x3C;p id="error">{inputErrors.email.join(',')}&#x3C;/p>}  &#x3C;button>Sign up&#x3C;/button>&#x3C;/form></span></span>
<span class="line"><span></span></span></code></pre>
<p>Note</p>
<p>Astro persists action <code>data</code> and <code>error</code> with a single-use cookie. This means <code>getActionResult()</code> will return a result on the first request <em>only</em>, and <code>undefined</code> when revisiting the page.</p>
<h4 id="preserve-input-values-on-error">Preserve input values on error</h4>
<p><a href="#preserve-input-values-on-error">Section titled Preserve input values on error</a>
Inputs will be cleared whenever a form is submitted. To persist input values, you can <a href="/en/guides/view-transitions/#adding-view-transitions-to-a-page">enable view transitions</a> on the page and apply the <code>transition:persist</code> directive to each input:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;input transition:persist required type="email" name="email" /></span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="update-the-ui-with-a-form-action-result">Update the UI with a form action result</h3>
<p><a href="#update-the-ui-with-a-form-action-result">Section titled Update the UI with a form action result</a>
The result returned by <code>Astro.getActionResult()</code> is single-use, and will reset to <code>undefined</code> whenever the page is refreshed. This is ideal for <a href="#handle-form-action-errors">displaying input errors</a> and showing temporary notifications to the user on success.</p>
<p>Tip</p>
<p>If you need a result to be displayed across page refreshes, consider storing the result in a database or <a href="/en/reference/api-reference/#astrocookies">in a cookie</a>.</p>
<p>Pass an action to <code>Astro.getActionResult()</code> and use the returned <code>data</code> property to render any temporary UI you want to display. This example uses the <code>productName</code> property returned by an <code>addToCart</code> action to show a success message:</p>
<p>src/pages/products/[slug].astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { actions } from 'astro:actions';</span></span>
<span class="line"><span>const result = Astro.getActionResult(actions.addToCart);---</span></span>
<span class="line"><span>{result &#x26;&#x26; !result.error &#x26;&#x26; (  &#x3C;p class="success">Added {result.data.productName} to cart&#x3C;/p>)}</span></span>
<span class="line"><span>&#x3C;!--...--></span></span>
<span class="line"><span></span></span></code></pre>
<p>Caution</p>
<p>Action data is passed using a persisted cookie. <strong>This cookie is not encrypted</strong> and is limited to 4 KB in size, although the exact limit may vary between browsers.</p>
<p>In general, we recommend returning the minimum information required from your action <code>handler</code> to avoid vulnerabilities, and persist other sensitive information in a database.</p>
<p>For example, you might return the name of a product in an <code>addToCart</code> action, rather than returning the entire <code>product</code> object:</p>
<p>src/actions/index.ts</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { defineAction } from 'astro:actions';</span></span>
<span class="line"><span>export const server = {  addToCart: defineAction({    handler: async () => {      /* ... */      return product;      return { productName: product.name };    }  })}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Learn</p> </div> <div class="prose-a:no-underline flex gap-2"> <span class="badge badge-outline badge-md"> <a href="/tags/basics/1/">basics</a> </span><span class="badge badge-outline badge-md"> <a href="/tags/Rust/1/">Rust</a> </span><span class="badge badge-outline badge-md"> <a href="/tags/Stylus/1/">Stylus</a> </span> </div> <div class="mt-4 flex justify-between"> <small>Publish on <span class="font-weight-bold">2024-01-06</span>，Update on <span class="font-weight-bold">2025-01-09</span></small> </div> </article> <div class="mt-12"> <div class="grid grid-cols-1 gap-4 md:grid-cols-3"> <div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/manage-your-content-guides-markdown-content/"> <picture> <source srcset="/_astro/photo-1472377723522-4768db9c41ce_cr2OL.avif 392w, /_astro/photo-1472377723522-4768db9c41ce_ZY6gfW.avif 700w, /_astro/photo-1472377723522-4768db9c41ce_1nCPx9.avif 980w, /_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif" srcset="/_astro/photo-1472377723522-4768db9c41ce_cr2OL.avif 392w, /_astro/photo-1472377723522-4768db9c41ce_ZY6gfW.avif 700w, /_astro/photo-1472377723522-4768db9c41ce_1nCPx9.avif 980w, /_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif 1960w" alt="white and brown concrete house near trees at daytime" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">astro-build</span><span class="badge badge-outline">Go</span><span class="badge badge-outline">Css</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-02-21</span></p> <h2 class="card-title">Markdown in Astro</h2> </div> </a> </div><div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/welcome-world-guides-deploy/"> <picture> <source srcset="/_astro/photo-1480074568708-e7b720bb3f09_Z2vlXMC.avif 392w, /_astro/photo-1480074568708-e7b720bb3f09_1nhPUA.avif 700w, /_astro/photo-1480074568708-e7b720bb3f09_Z1kab5f.avif 980w, /_astro/photo-1480074568708-e7b720bb3f09_vUEOm.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1480074568708-e7b720bb3f09_vUEOm.avif" srcset="/_astro/photo-1480074568708-e7b720bb3f09_Z2vlXMC.avif 392w, /_astro/photo-1480074568708-e7b720bb3f09_1nhPUA.avif 700w, /_astro/photo-1480074568708-e7b720bb3f09_Z1kab5f.avif 980w, /_astro/photo-1480074568708-e7b720bb3f09_vUEOm.avif 1960w" alt="white house under maple trees" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">guide</span><span class="badge badge-outline">CSharp</span><span class="badge badge-outline">Sass</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-02-16</span></p> <h2 class="card-title">Deploy your Astro Site</h2> </div> </a> </div><div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/core-concepts-concepts-islands/"> <picture> <source srcset="/_astro/photo-1483366774565-c783b9f70e2c_jGYEQ.avif 392w, /_astro/photo-1483366774565-c783b9f70e2c_ZQPjpR.avif 700w, /_astro/photo-1483366774565-c783b9f70e2c_1uSMne.avif 980w, /_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif" srcset="/_astro/photo-1483366774565-c783b9f70e2c_jGYEQ.avif 392w, /_astro/photo-1483366774565-c783b9f70e2c_ZQPjpR.avif 700w, /_astro/photo-1483366774565-c783b9f70e2c_1uSMne.avif 980w, /_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif 1960w" alt="worm's-eye view photography of concrete building" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">tutorial</span><span class="badge badge-outline">CSharp</span><span class="badge badge-outline">Less</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-02-12</span></p> <h2 class="card-title">Astro Islands</h2> </div> </a> </div> </div> </div> </main>  </main> <footer class="mx-auto mt-auto w-full max-w-[85rem] py-10"> <nav class="mx-auto w-full max-w-[85rem] px-4" aria-label="Footer"> <div class="flex flex-col items-center sm:flex-row sm:justify-between"> <div id="navbar-alignment" class="internal-links sm:order-2"> <div class="mt-2 flex flex-row gap-5 sm:mt-0 sm:flex-row sm:items-center sm:ps-5"> <a href="/posts/core-concepts-concepts-why-astro/" class="inline-flex gap-x-2 text-sm"> Astro </a><a href="/posts/assets-guides-styling/" class="inline-flex gap-x-2 text-sm"> Styling </a><a href="/tags/" class="inline-flex gap-x-2 text-sm"> Tags </a> </div> </div> <div class="mt-2 flex flex-wrap gap-2 sm:order-3 sm:mb-0 sm:gap-0"> <button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="/rss.xml" class="absolute inset-0 z-10" aria-label="RSS"></a> <i class="i-tabler-rss icon-base"></i> </button><button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="https://twitter.com/astrodotbuild" class="absolute inset-0 z-10" aria-label="Twitter"></a> <i class="i-tabler-brand-twitter icon-base"></i> </button><button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="https://github.com/isooosi" class="absolute inset-0 z-10" aria-label="GitHub"></a> <i class="i-tabler-brand-github icon-base"></i> </button> </div> <div class="mt-2 sm:order-1 sm:mb-0"> <a class="flex-none text-sm" href="/" aria-label="Brand">AstroMelody &copy; 2025</a> </div> </div> </nav> </footer> </body></html>