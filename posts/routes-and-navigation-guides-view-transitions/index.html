<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.7"><!-- Canonical URL --><link rel="canonical" href="https://10ta.github.io/posts/routes-and-navigation-guides-view-transitions/"><!-- Sitemap --><link rel="sitemap" href="/sitemap-index.xml"><!-- Primary Meta Tags --><title>View Transitions</title><meta name="title" content="View Transitions"><meta name="description" content="Enable seamless navigation between pages in Astro with view transitions."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://10ta.github.io/posts/routes-and-navigation-guides-view-transitions/"><meta property="og:title" content="View Transitions"><meta property="og:description" content="Enable seamless navigation between pages in Astro with view transitions."><meta property="og:image" content="https://10ta.github.io/blog-placeholder-1.avif"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://10ta.github.io/posts/routes-and-navigation-guides-view-transitions/"><meta property="twitter:title" content="View Transitions"><meta property="twitter:description" content="Enable seamless navigation between pages in Astro with view transitions."><meta property="twitter:image" content="https://10ta.github.io/blog-placeholder-1.avif"><link rel="stylesheet" href="/_astro/_page_.Bdwf1GY7.css"><script type="module" src="/_astro/hoisted.CPfS8Ggc.js"></script>
<script type="module" src="/_astro/page.DTIbhfSr.js"></script>
<script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.10.2 - MIT builder.io */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,d,l,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(l=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(v,1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.10.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<l.length;n++)(o=r.createElement("script")).innerHTML=l[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(d)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="flex flex-col min-h-screen mx-auto max-w-6xl px-4 dark:prose-invert sm:px-6 lg:px-8"> <header class="z-50 flex w-full flex-wrap py-7 md:flex-nowrap md:justify-start"> <nav class="relative mx-auto flex w-full max-w-7xl basis-full flex-wrap items-center px-4" aria-label="Global"> <div class=""> <a class="flex-none text-xl font-semibold" href="/" aria-label="Astroverse"> AstroMelody </a> </div> <div class="ms-auto flex items-center gap-x-2 py-1"> <a class="inline-flex items-center gap-x-2 rounded-xl border border-transparent px-3 py-2 text-sm font-medium disabled:pointer-events-none disabled:opacity-50" href="/search/" href="/search/"> <i class="icon-base i-tabler-search"></i> </a> <div class="dropdown dropdown-end"> <div tabindex="0" role="button" class="flex size-[38px] items-center justify-center rounded-xl text-sm font-semibold"> <i class="icon-base i-tabler-category-2"></i> </div> <ul tabindex="0" class="menu dropdown-content z-[1] w-52 rounded-box bg-base-100 p-2 shadow"> <li> <a href="/category/One/1/" class="px-4 py-3 font-medium"> One </a> </li><li> <a href="/category/Two/1/" class="px-4 py-3 font-medium"> Two </a> </li><li> <a href="/category/Three/1/" class="px-4 py-3 font-medium"> Three </a> </li> </ul> </div> <label class="swap swap-rotate rounded-xl px-3 py-2 text-sm"> <!-- this hidden checkbox controls the state --> <input type="checkbox" class="theme-controller" data-unchecked-value="corporate" value="halloween"> <!-- sun icon --> <i class="icon-base swap-off i-tabler-sun-filled"></i> <!-- moon icon --> <i class="icon-base swap-on i-tabler-moon-filled"></i> </label> </div> </nav> </header> <!-- Save theme to localStorage --> <script>
  const lightTheme =  document.querySelector('.theme-controller')?.getAttribute('data-unchecked-value');
  // ☝️ This script prevent the FART effect.
  if (localStorage.getItem("theme") === null) {
    document.documentElement.setAttribute("data-theme", lightTheme);
  } else
    document.documentElement.setAttribute(
      "data-theme",
      localStorage.getItem("theme"),
    );
  // "theme" LocalStorage value is set by the package to remember user preference.
  // The value is checked and applyed before rendering anything.
</script>  <!-- 内容区域，确保其动态调整高度 --> <main class="flex-grow">  <main> <article class="prose mx-auto dark:prose-invert"> <div class="prose-h1 text-center"> <h1>View Transitions</h1> </div> <div> <picture> <source srcset="/_astro/photo-1472377723522-4768db9c41ce_cr2OL.avif 392w, /_astro/photo-1472377723522-4768db9c41ce_ZY6gfW.avif 700w, /_astro/photo-1472377723522-4768db9c41ce_1nCPx9.avif 980w, /_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif" srcset="/_astro/photo-1472377723522-4768db9c41ce_cr2OL.avif 392w, /_astro/photo-1472377723522-4768db9c41ce_ZY6gfW.avif 700w, /_astro/photo-1472377723522-4768db9c41ce_1nCPx9.avif 980w, /_astro/photo-1472377723522-4768db9c41ce_Z1EwWzk.avif 1960w" alt="white and brown concrete house near trees at daytime" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> </div> <div> <p>Astro supports <strong>opt-in, per-page, view transitions</strong> with just a few lines of code. View transitions update your page content without the browser’s normal, full-page navigation refresh and provide seamless animations between pages.</p>
<p>Astro provides a <code>&#x3C;ViewTransitions /></code> routing component that can be added to a single page’s <code>&#x3C;head></code> to control page transitions as you navigate away to another page. It provides a lightweight client-side router that <a href="#client-side-navigation-process">intercepts navigation</a> and allows you to customize the transition between pages.</p>
<p>Add this component to a reusable <code>.astro</code> component, such as a common head or layout, for <a href="#full-site-view-transitions-spa-mode">animated page transitions across your entire site (SPA mode)</a>.</p>
<p>Astro’s view transitions support is powered by the new <a href="https://developer.chrome.com/docs/web-platform/view-transitions/">View Transitions</a> browser API and also includes:</p>
<ul>
<li>A few <a href="#built-in-animation-directives">built-in animation options</a>, such as <code>fade</code>, <code>slide</code>, and <code>none</code>.</li>
<li>Support for both forwards and backwards navigation animations.</li>
<li>The ability to fully <a href="#customizing-animations">customize all aspects of transition animation</a>, and build your own animations.</li>
<li>The option to <a href="#preventing-client-side-navigation">prevent client-side navigation for non-page links</a>.</li>
<li><a href="#fallback-control">Control over fallback behavior</a> for browsers that do not yet support the View Transition APIs.</li>
<li>Automatic support for <a href="#prefers-reduced-motion"><code>prefers-reduced-motion</code></a>.</li>
</ul>
<p>Note</p>
<p>By default, every page will use regular, full-page, browser navigation. You must opt in to view transitions and can use them either on a per-page basis or site-wide.</p>
<h2 id="adding-view-transitions-to-a-page">Adding View Transitions to a Page</h2>
<p><a href="#adding-view-transitions-to-a-page">Section titled Adding View Transitions to a Page</a>
Opt in to using view transitions on individual pages by importing and adding the <code>&#x3C;ViewTransitions /></code> routing component to <code>&#x3C;head></code> on every desired page.</p>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { ViewTransitions } from 'astro:transitions';---&#x3C;html lang="en">  &#x3C;head>    &#x3C;title>My Homepage&#x3C;/title>    &#x3C;ViewTransitions />  &#x3C;/head>  &#x3C;body>    &#x3C;h1>Welcome to my website!&#x3C;/h1>  &#x3C;/body>&#x3C;/html></span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="full-site-view-transitions-spa-mode">Full site view transitions (SPA mode)</h2>
<p><a href="#full-site-view-transitions-spa-mode">Section titled Full site view transitions (SPA mode)</a>
Import and add the <code>&#x3C;ViewTransitions /></code> component to your common <code>&#x3C;head></code> or shared layout component. Astro will create default page animations based on the similarities between the old and new page, and will also provide fallback behavior for unsupported browsers.</p>
<p>The example below shows adding Astro’s default page navigation animations site-wide, including the default fallback control option for non-supporting browsers, by importing and adding this component to a <code>&#x3C;CommonHead /></code> Astro component:</p>
<p>src/components/CommonHead.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { ViewTransitions } from 'astro:transitions';---&#x3C;link rel="icon" type="image/svg+xml" href="/favicon.svg" />&#x3C;meta name="generator" content={Astro.generator} /></span></span>
<span class="line"><span>&#x3C;!-- Primary Meta Tags -->&#x3C;title>{title}&#x3C;/title>&#x3C;meta name="title" content={title} />&#x3C;meta name="description" content={description} /></span></span>
<span class="line"><span>&#x3C;ViewTransitions /></span></span>
<span class="line"><span></span></span></code></pre>
<p>No other configuration is necessary to enable Astro’s default client-side navigation!</p>
<p>Use <a href="#transition-directives">transition directives</a> or <a href="#preventing-client-side-navigation">override default client-side navigation</a> on individual elements for finer control.</p>
<h2 id="transition-directives">Transition Directives</h2>
<p><a href="#transition-directives">Section titled Transition Directives</a>
Astro will automatically assign corresponding elements found in both the old page and the new page a shared, unique <code>view-transition-name</code>. This pair of matching elements is inferred by both the type of element and its location in the DOM.</p>
<p>Use optional <code>transition:*</code> directives on page elements in your <code>.astro</code> components for finer control over the page transition behaviour during navigation.</p>
<ul>
<li><code>transition:name</code>: Allows you to override Astro’s default element matching for old/new content animation and <a href="#naming-a-transition">specify a transition name</a> to associate a pair of DOM elements.</li>
<li><code>transition:animate</code>: Allows you to override Astro’s default animation while replacing the old element with the new one by specifying an animation type. Use Astro’s <a href="#built-in-animation-directives">built-in animation directives</a> or <a href="#customizing-animations">create custom transition animations</a>.</li>
<li><code>transition:persist</code>: Allows you to override Astro’s default replacing old elements for new ones and instead <a href="#maintaining-state">persist components and HTML elements</a> when navigating to another page.</li>
</ul>
<h3 id="naming-a-transition">Naming a transition</h3>
<p><a href="#naming-a-transition">Section titled Naming a transition</a>
In some cases, you may want or need to identify the corresponding view transition elements yourself. You can specify a name for a pair of elements using the <code>transition:name</code> directive.</p>
<p>src/pages/old-page.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;aside transition:name="hero"></span></span>
<span class="line"><span></span></span></code></pre>
<p>src/pages/new-page.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;aside transition:name="hero"></span></span>
<span class="line"><span></span></span></code></pre>
<p>Note that the provided <code>transition:name</code> value can only be used once on each page. Set this manually when Astro can’t infer a proper name itself, or for more fine control over matching elements.</p>
<h3 id="maintaining-state">Maintaining State</h3>
<p><a href="#maintaining-state">Section titled Maintaining State</a></p>
<p><strong>Added in:</strong>
<code>astro@2.10.0</code></p>
<p>You can persist components and HTML elements (instead of replacing them) across page navigations using the <code>transition:persist</code> directive.</p>
<p>For example, the following <code>&#x3C;video></code> will continue to play as you navigate to another page that contains the same video element. This works for both forwards and backwards navigation.</p>
<p>src/components/Video.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;video controls="" autoplay="" transition:persist>  &#x3C;source src="https://ia804502.us.archive.org/33/items/GoldenGa1939_3/GoldenGa1939_3_512kb.mp4" type="video/mp4">&#x3C;/video></span></span>
<span class="line"><span></span></span></code></pre>
<p>You can also place the directive on an <a href="/en/concepts/islands/">Astro island</a> (a UI framework component with a <a href="/en/reference/directives-reference/#client-directives"><code>client:</code> directive</a>). If that component exists on the next page, the island from the old page <strong>with its current state</strong> will continue to be displayed, instead of replacing it with the island from the new page.</p>
<p>In the example below, the component’s internal state of the count will not be reset when navigating back and forth across pages that contain the <code>&#x3C;Counter /></code> component with the <code>transition:persist</code> attribute.</p>
<p>components/Header.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;Counter client:load transition:persist initialCount={5} /></span></span>
<span class="line"><span></span></span></code></pre>
<p>Known limitations</p>
<p>Not all state can be preserved in this way. The restart of CSS animations and the reload of iframes cannot be avoided during view transitions even when using <code>transition:persist</code>.</p>
<p>You can also <a href="#naming-a-transition">manually identify corresponding elements</a> if the island/element is in a different component between the two pages.</p>
<p>src/pages/old-page.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;Video controls="" autoplay="" transition:name="media-player" transition:persist /></span></span>
<span class="line"><span></span></span></code></pre>
<p>src/pages/new-page.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;MyVideo controls="" autoplay="" transition:name="media-player" transition:persist /></span></span>
<span class="line"><span></span></span></code></pre>
<p>As a convenient shorthand, <code>transition:persist</code> can alternatively take a transition name as a value.</p>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;video controls="" autoplay="" transition:persist="media-player"></span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="transitionpersist-props"><code>transition:persist-props</code></h4>
<p><a href="#transitionpersist-props">Section titled transition:persist-props</a></p>
<p><strong>Added in:</strong>
<code>astro@4.5.0</code></p>
<p>This allows you to control whether or not an island’s props should be persisted upon navigation.</p>
<p>By default, when you add <code>transition:persist</code> to an island, the state is retained upon navigation, but your component will re-render with new props. This is useful, for example, when a component receives page-specific props such as the current page’s <code>title</code>.</p>
<p>You can override this behavior by setting <code>transition:persist-props</code> in addition to <code>transition:persist</code>. Adding this directive will keep an island’s existing props (not re-render with new values) in addition to maintaining its existing state.</p>
<h3 id="built-in-animation-directives">Built-in Animation Directives</h3>
<p><a href="#built-in-animation-directives">Section titled Built-in Animation Directives</a>
Astro comes with a few built-in animations to override the default <code>fade</code> transition. Add the <code>transition:animate</code> directive to individual elements to customize the behavior of specific transitions.</p>
<ul>
<li><code>fade</code> (default): An opinionated crossfade animation. The old content fades out and the new content fades in.</li>
<li><code>initial</code>: Opt out of Astro’s opinionated crossfade animation and use the browser’s default styling.</li>
<li><code>slide</code>: An animation where the old content slides out to the left and new content slides in from the right. On backwards navigation, the animations are the opposite.</li>
<li><code>none</code>: Disable the browser’s default animations. Use on a page’s <code>&#x3C;html></code> element to disable the default fade for every element on the page.</li>
</ul>
<p>Combine directives for full control over your page animation. Set a page default on the <code>&#x3C;html></code> element, and override on any individual elements as desired.</p>
<p>The example below produces a slide animation for the body content while disabling the browser’s default fade animation for the rest of the page:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import CommonHead from '../components/CommonHead.astro';---</span></span>
<span class="line"><span>&#x3C;html transition:animate="none">  &#x3C;head>    &#x3C;CommonHead />  &#x3C;/head>  &#x3C;body>    &#x3C;header>      ...    &#x3C;/header>    &#x3C;!-- Override your page default on a single element -->    &#x3C;main transition:animate="slide">      ...    &#x3C;/main>  &#x3C;/body>&#x3C;/html></span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="customizing-animations">Customizing Animations</h3>
<p><a href="#customizing-animations">Section titled Customizing Animations</a>
You can customize all aspects of a transition with any CSS animation properties.</p>
<p>To customize a built-in animation, first import the animation from <code>astro:transitions</code>, and then pass in customization options.</p>
<p>The example below customizes the duration of the built-in <code>fade</code> animation:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { fade } from 'astro:transitions';---</span></span>
<span class="line"><span>&#x3C;header transition:animate={fade({ duration: '0.4s' })}></span></span>
<span class="line"><span></span></span></code></pre>
<p>You can also define your own animations for use with <code>transition:animate</code> by defining both the forwards and backwards behavior, as well as new and old pages, according to the following types:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>export interface TransitionAnimation {  name: string; // The name of the keyframe  delay?: number | string;  duration?: number | string;  easing?: string;  fillMode?: string;  direction?: string;}</span></span>
<span class="line"><span>export interface TransitionAnimationPair {  old: TransitionAnimation | TransitionAnimation[];  new: TransitionAnimation | TransitionAnimation[];}</span></span>
<span class="line"><span>export interface TransitionDirectionalAnimations {  forwards: TransitionAnimationPair;  backwards: TransitionAnimationPair;}</span></span>
<span class="line"><span></span></span></code></pre>
<p>The following example shows all the necessary properties to define a custom <code>bump</code> animation inside a <code>&#x3C;style is:global></code> tag in your root layout file:</p>
<p>src/layouts/Layout.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { ViewTransitions } from 'astro:transitions';---</span></span>
<span class="line"><span>&#x3C;html lang="en">  &#x3C;head>    &#x3C;ViewTransitions />  &#x3C;/head>  &#x3C;body>    &#x3C;slot />  &#x3C;/body>&#x3C;/html></span></span>
<span class="line"><span>&#x3C;style is:global>  @keyframes bump {    0% {      opacity: 0;      transform: scale(1) translateX(200px);    }    50% {      opacity: 0.5;      transform: scale(1.1);    }    100% {      opacity: 1;      transform: scale(1) translateX(0);    }  }&#x3C;/style></span></span>
<span class="line"><span></span></span></code></pre>
<p>The animation’s behavior must be defined in the frontmatter of every component using the animation:</p>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---const anim = {  old: {    name: 'bump',    duration: '0.5s',    easing: 'ease-in',    direction: 'reverse',  },  new: {    name: 'bump',    duration: '0.5s',    easing: 'ease-in-out',  },};</span></span>
<span class="line"><span>const customTransition = {  forwards: anim,  backwards: anim,};---</span></span>
<span class="line"><span>&#x3C;header transition:animate={customTransition}> ... &#x3C;/header></span></span>
<span class="line"><span></span></span></code></pre>
<p>You have great flexibility when defining custom animations. To achieve your desired result, you may wish to consider unusual combinations such as using different objects for forward and backward, or providing separate keyframe animations for old and new.</p>
<h2 id="router-control">Router control</h2>
<p><a href="#router-control">Section titled Router control</a>
The <code>&#x3C;ViewTransitions /></code> router handles navigation by listening to:</p>
<ul>
<li>Clicks on <code>&#x3C;a></code> elements.</li>
<li>Backwards and forwards navigation events.</li>
</ul>
<p>The following options allow you to further control when navigation occurs within the router:</p>
<ul>
<li><code>data-astro-reload</code>: an <code>&#x3C;a></code> tag attribute to <a href="#preventing-client-side-navigation">force a full-page navigation</a></li>
<li><code>data-astro-history="auto | push | replace"</code>: an <code>&#x3C;a></code> tag attribute to <a href="#replace-entries-in-the-browser-history">control the browser’s history</a></li>
<li><code>navigate(href, options)</code>: a method available to any client script or client component to <a href="#trigger-navigation">trigger navigation</a></li>
</ul>
<h3 id="preventing-client-side-navigation">Preventing client-side navigation</h3>
<p><a href="#preventing-client-side-navigation">Section titled Preventing client-side navigation</a>
There are some cases where you cannot navigate via client-side routing since both pages involved must use the <code>&#x3C;ViewTransitions /></code> router to prevent a full-page reload. You may also not want client-side routing on every navigation change and would prefer a traditional page navigation on select routes instead.</p>
<p>You can opt out of client-side routing on a per-link basis by adding the <code>data-astro-reload</code> attribute to any <code>&#x3C;a></code> or <code>&#x3C;form></code> tag. This attribute will override any existing <code>&#x3C;ViewTransitions /></code> component and instead trigger a browser refresh during navigation.</p>
<p>The following example shows preventing client-side routing when navigating to an article from the home page only. This still allows you to have animation on shared elements, such as a hero image, when navigating to the same page from an article listing page:</p>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;a href="/articles/emperor-penguins" data-astro-reload></span></span>
<span class="line"><span></span></span></code></pre>
<p>src/pages/articles.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;a href="/articles/emperor-penguins"></span></span>
<span class="line"><span></span></span></code></pre>
<p>Links with the <code>data-astro-reload</code> attribute will be ignored by the router and a full-page navigation will occur.</p>
<h3 id="trigger-navigation">Trigger navigation</h3>
<p><a href="#trigger-navigation">Section titled Trigger navigation</a>
You can also trigger client-side navigation via events not normally listened to by the <code>&#x3C;ViewTransitions /></code> router using <code>navigate</code>. This function from the <code>astro:transitions/client</code> module can be used in scripts, and in framework components that are hydrated with a <a href="/en/reference/directives-reference/#client-directives">client directive</a>.</p>
<p>The following example shows an Astro component that navigates a visitor to another page they select from a menu:</p>
<p>src/components/Form.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;script>  import { navigate } from 'astro:transitions/client';</span></span>
<span class="line"><span>  // Navigate to the selected option automatically.  document.querySelector('select').onchange = (event) => {    let href = event.target.value;    navigate(href);  };&#x3C;/script>&#x3C;select>  &#x3C;option value="/play">Play&#x3C;/option>  &#x3C;option value="/blog">Blog&#x3C;/option>  &#x3C;option value="/about">About&#x3C;/option>  &#x3C;option value="/contact">Contact&#x3C;/option>&#x3C;/select></span></span>
<span class="line"><span></span></span></code></pre>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import Form from "../components/Form.astro";import { ViewTransitions } from "astro:transitions";---&#x3C;html>  &#x3C;head>    &#x3C;ViewTransitions />  &#x3C;/head>  &#x3C;body>    &#x3C;Form />  &#x3C;/body>&#x3C;/html></span></span>
<span class="line"><span></span></span></code></pre>
<p>The following example implements the same using <code>navigate()</code> in a React <code>&#x3C;Form /></code> component:</p>
<p>src/components/Form.jsx</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { navigate } from "astro:transitions/client";</span></span>
<span class="line"><span>export default function Form() {  return (    &#x3C;select onChange={(e) => navigate(e.target.value)}>      &#x3C;option value="/play">Play&#x3C;/option>      &#x3C;option value="/blog">Blog&#x3C;/option>      &#x3C;option value="/about">About&#x3C;/option>      &#x3C;option value="/contact">Contact&#x3C;/option>    &#x3C;/select>  );}</span></span>
<span class="line"><span></span></span></code></pre>
<p>The <code>&#x3C;Form /></code> component can then be rendered on an Astro page that uses the <code>&#x3C;ViewTransitions /></code> router, with a client directive:</p>
<p>src/pages/index.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import Form from "../components/Form.jsx";import { ViewTransitions } from "astro:transitions";---&#x3C;html>  &#x3C;head>    &#x3C;ViewTransitions />  &#x3C;/head>  &#x3C;body>    &#x3C;Form client:load />  &#x3C;/body>&#x3C;/html></span></span>
<span class="line"><span></span></span></code></pre>
<p>The <code>navigate</code> method takes these arguments:</p>
<ul>
<li><code>href</code> (required) - The new page to navigate to.</li>
<li><code>options</code> - An optional object with the following properties:
<ul>
<li><code>history</code>: <code>'push'</code> | <code>'replace'</code> | <code>'auto'</code>
<ul>
<li><code>'push'</code>: the router will use <code>history.pushState</code> to create a new entry in the browser history.</li>
<li><code>'replace'</code>: the router will use <code>history.replaceState</code> to update the URL without adding a new entry into navigation.</li>
<li><code>'auto'</code> (default): the router will attempt <code>history.pushState</code>, but if the URL is not one that can be transitioned to, the current URL will remain with no changes to the browser history.</li>
</ul>
</li>
<li><code>formData</code>: A FormData object for <code>POST</code> requests.</li>
</ul>
</li>
</ul>
<p>For backward and forward navigation through the browser history, you can combine <code>navigate()</code> with the built-in <code>history.back()</code>, <code>history.forward()</code> and <code>history.go()</code> functions of the browser. If <code>navigate()</code> is called during the server-side render of your component, it has no effect.</p>
<h3 id="replace-entries-in-the-browser-history">Replace entries in the browser history</h3>
<p><a href="#replace-entries-in-the-browser-history">Section titled Replace entries in the browser history</a>
Normally, each time you navigate, a new entry is written to the browser’s history. This allows navigation between pages using the browser’s <code>back</code> and <code>forward</code> buttons.</p>
<p>The <code>&#x3C;ViewTransitions /></code> router allows you to overwrite history entries by adding the <code>data-astro-history</code> attribute to any individual <code>&#x3C;a></code> tag.</p>
<p>The <code>data-astro-history</code> attribute can be set to the same three values as the <a href="#trigger-navigation"><code>history</code> option of the <code>navigate()</code> function</a>:</p>
<p><code>data-astro-history</code>: <code>'push'</code> | <code>'replace'</code> | <code>'auto'</code></p>
<ul>
<li><code>'push'</code>: the router will use <code>history.pushState</code> to create a new entry in the browser history.</li>
<li><code>'replace'</code>: the router will use <code>history.replaceState</code> to update the URL without adding a new entry into navigation.</li>
<li><code>'auto'</code> (default): the router will attempt <code>history.pushState</code>, but if the URL is not one that can be transitioned to, the current URL will remain with no changes to the browser history.</li>
</ul>
<p>The following example navigates to the <code>/main</code> page but does not add a new entry to the browsing history. Instead, it reuses the current entry in the history (<code>/confirmation</code>) and overwrites it.</p>
<p>src/pages/confirmation.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;a href="/main" data-astro-history="replace"></span></span>
<span class="line"><span></span></span></code></pre>
<p>This has the effect that if you go back from the <code>/main</code> page, the browser will not display the <code>/confirmation</code> page, but the page before it.</p>
<h3 id="transitions-with-forms">Transitions with forms</h3>
<p><a href="#transitions-with-forms">Section titled Transitions with forms</a></p>
<p><strong>Added in:</strong>
<code>astro@4.0.0</code></p>
<p>The <code>&#x3C;ViewTransitions /></code> router will trigger in-page transitions from <code>&#x3C;form></code> elements, supporting both <code>GET</code> and <code>POST</code> requests.</p>
<p>By default, Astro submits your form data as <code>multipart/form-data</code> when your <code>method</code> is set to <code>POST</code>. If you want to match the default behavior of web browsers, use the <code>enctype</code> attribute to submit your data encoded as <code>application/x-www-form-urlencoded</code>:</p>
<p>src/components/Form.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;form action="/contact" method="POST" enctype="application/x-www-form-urlencoded">  &#x3C;!-- -->&#x3C;/form></span></span>
<span class="line"><span></span></span></code></pre>
<p>You can opt out of router transitions on any individual form using the <code>data-astro-reload</code> attribute:</p>
<p>src/components/Form.astro</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;form action="/contact" data-astro-reload>  &#x3C;!-- -->&#x3C;/form></span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="fallback-control">Fallback control</h2>
<p><a href="#fallback-control">Section titled Fallback control</a>
The <code>&#x3C;ViewTransitions /></code> router works best in browsers that support View Transitions (i.e. Chromium browsers), but also includes default fallback support for other browsers. Even if the browser does not support the View Transitions API, Astro will still provide in-browser navigation using one of the fallback options for a comparable experience.</p>
<p>You can override Astro’s default fallback support by adding a <code>fallback</code> property on the <code>&#x3C;ViewTransitions /></code> component and setting it to <code>swap</code> or <code>none</code>:</p>
<ul>
<li><code>animate</code> (default, recommended) - Astro will simulate view transitions using custom attributes before updating page content.</li>
<li><code>swap</code> - Astro will not attempt to animate the page. Instead, the old page will be immediately replaced by the new one.</li>
<li><code>none</code> - Astro will not do any animated page transitions at all. Instead, you will get full page navigation in non-supporting browsers.</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>---import { ViewTransitions } from 'astro:transitions';---&#x3C;title>My site&#x3C;/title></span></span>
<span class="line"><span>&#x3C;ViewTransitions fallback="swap" /></span></span>
<span class="line"><span></span></span></code></pre>
<p>Known limitations</p>
<p>The <code>initial</code> browser animation is not simulated by Astro. So any element using this animation will not currently be animated.</p>
<h2 id="client-side-navigation-process">Client-side navigation process</h2>
<p><a href="#client-side-navigation-process">Section titled Client-side navigation process</a>
When using the <code>&#x3C;ViewTransitions /></code> router, the following steps occur to produce Astro’s client-side navigation:</p>
<ol>
<li>
<p>A visitor to your site triggers navigation by any of the following actions:</p>
<ul>
<li>Clicking an <code>&#x3C;a></code> tag linking internally to another page on your site.</li>
<li>Clicking the back button.</li>
<li>Clicking the forward button.</li>
</ul>
</li>
<li>
<p>The router starts fetching the next page.</p>
</li>
<li>
<p>The router adds the <code>data-astro-transition</code> attribute to the HTML element with a value of <code>'forward'</code> or <code>'back'</code> as appropriate.</p>
</li>
<li>
<p>The router calls <code>document.startViewTransition</code>. This triggers the browser’s own <a href="https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API#the_view_transition_process">view transition process</a>. Importantly, the browser screenshots the current state of the page.</p>
</li>
<li>
<p>Inside the <code>startViewTransition</code> callback, the router performs a <strong>swap</strong>, which consists of the following sequence of events:</p>
<ul>
<li>
<p>The contents of the <code>&#x3C;head></code> are swapped out, with some elements kept:</p>
<ul>
<li>Stylesheet DOM nodes are left in if they exist on the new page, to prevent FOUC.</li>
<li>Scripts are left in if they exist on the new page.</li>
<li>Any other head elements with <code>transition:persist</code> are left in if there is a corresponding element in the new page.</li>
</ul>
</li>
<li>
<p>The <code>&#x3C;body></code> is completely replaced with the new page’s body.</p>
</li>
<li>
<p>Elements marked <code>transition:persist</code> are moved over to the new DOM if they exist on the new page.</p>
</li>
<li>
<p>Scroll position is restored if necessary.</p>
</li>
<li>
<p>The <code>astro:after-swap</code> event is triggered on the <code>document</code>. This is the end of the <strong>swap</strong> process.</p>
</li>
</ul>
</li>
<li>
<p>The router waits for any new stylesheets to load before resolving the transition.</p>
</li>
<li>
<p>The router executes any new scripts added to the page.</p>
</li>
<li>
<p>The <code>astro:page-load</code> event fires. This is the end of the navigation process.</p>
</li>
</ol>
<h2 id="script-behavior-with-view-transitions">Script behavior with view transitions</h2>
<p><a href="#script-behavior-with-view-transitions">Section titled Script behavior with view transitions</a>
When you add view transitions to an existing Astro project, some of your scripts may no longer re-run after page navigation like they did with full-page browser refreshes. Use the following information to ensure that your scripts execute as expected.</p>
<h3 id="script-order">Script order</h3>
<p><a href="#script-order">Section titled Script order</a>
When navigating between pages with the <code>&#x3C;ViewTransitions /></code> component, scripts are run in sequential order to match browser behavior.</p>
<h3 id="script-re-execution">Script re-execution</h3>
<p><a href="#script-re-execution">Section titled Script re-execution</a>
<a href="/en/guides/client-side-scripts/#script-processing">Bundled module scripts</a>, which are the default scripts in Astro, are only ever executed once. After initial execution they will be ignored, even if the script exists on the new page after a transition.</p>
<p>Unlike bundled module scripts, <a href="/en/guides/client-side-scripts/#opting-out-of-processing">inline scripts</a> have the potential to be re-executed during a user’s visit to a site if they exist on a page that is visited multiple times. Inline scripts might also re-execute when a visitor navigates to a page without the script, and then back to one with the script.</p>
<p>With view transitions, some scripts may no longer re-run after page navigation like they do with full-page browser refreshes. There are several <a href="#lifecycle-events">events during client-side routing that you can listen for</a>, and fire events when they occur. You can wrap an existing script in an event listener to ensure it runs at the proper time in the navigation cycle.</p>
<p>src/scripts/menu.js</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;script>document.addEventListener('astro:page-load', () => {  document.querySelector('.hamburger').addEventListener('click', () => {    document.querySelector('.nav-links').classList.toggle('expanded');  });});&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="data-astro-rerun"><code>data-astro-rerun</code></h4>
<p><a href="#data-astro-rerun">Section titled data-astro-rerun</a></p>
<p><strong>Added in:</strong>
<code>astro@4.5.0</code></p>
<p>To force inline scripts to re-execute after every transition, add the <code>data-astro-rerun</code> property. Adding any attribute to a script also implicitly adds <code>is:inline</code>, so this is only available for scripts that are not bundled and processed by Astro.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;script is:inline data-astro-rerun>...&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<p>To ensure that a script runs every time a page is loaded during client-side navigation, it should be executed by a <a href="#lifecycle-events">lifecycle event</a>. For example, event listeners for <code>DOMContentLoaded</code> can be replaced by the <a href="/en/guides/view-transitions/#astropage-load"><code>astro:page-load</code></a> lifecycle event.</p>
<p>If you have code that sets up a global state in an inline script, this state will need to take into account that the script might execute more than once. Check for the global state in your <code>&#x3C;script></code> tag, and conditionally execute your code where possible. This works because <code>window</code> is preserved.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;script is:inline>  if (!window.SomeGlobal) {    window.SomeGlobal = {} // ....  }&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<p>See the <a href="/en/tutorials/add-view-transitions/#update-scripts">Add View Transitions Tutorial</a> for an example of updating existing scripts in a project.</p>
<h2 id="lifecycle-events">Lifecycle events</h2>
<p><a href="#lifecycle-events">Section titled Lifecycle events</a>
The <code>&#x3C;ViewTransition /></code> router fires a number of events on the <code>document</code> during navigation. These events provide hooks into the lifecycle of navigation, allowing you to do things like show indicators that a new page is loading, override default behavior, and restore state as navigation is completing.</p>
<p>The navigation process involves a <strong>preparation</strong> phase, when new content is loaded; a <strong>DOM swap</strong> phase, where the old page’s content is replaced by the new page’s content; and a <strong>completion</strong> phase where scripts are executed, loading is reported as completed and clean-up work is carried out.</p>
<p>Astro’s View Transition API lifecycle events in order are:</p>
<ul>
<li><a href="#astrobefore-preparation"><code>astro:before-preparation</code></a></li>
<li><a href="#astroafter-preparation"><code>astro:after-preparation</code></a></li>
<li><a href="#astrobefore-swap"><code>astro:before-swap</code></a></li>
<li><a href="#astroafter-swap"><code>astro:after-swap</code></a></li>
<li><a href="#astropage-load"><code>astro:page-load</code></a></li>
</ul>
<p>Tip</p>
<p><code>before-</code> events allow you to influence and modify actions that are about to take place, and <code>after-</code> events are notifications that a phase is complete.</p>
<p>While some actions can be triggered during any event, some tasks can only be performed during a specific event for best results, such as displaying a loading spinner before preparation or overriding animation pairs before swapping content.</p>
<h3 id="astrobefore-preparation"><code>astro:before-preparation</code></h3>
<p><a href="#astrobefore-preparation">Section titled astro:before-preparation</a></p>
<p><strong>Added in:</strong>
<code>astro@3.6.0</code></p>
<p>An event that fires at the beginning of the preparation phase, after navigation has started (e.g. after the user has clicked a link), but before content is loaded.</p>
<p>This event is used:</p>
<ul>
<li>To do something before loading has started, such as showing a loading spinner.</li>
<li>To alter loading, such as loading content you’ve defined in a template rather than from the external URL.</li>
<li>To change the <code>direction</code> of the navigation (which is usually either <code>forward</code> or <code>backward</code>) for custom animation.</li>
</ul>
<p>Here is an example of using the <code>astro:before-preparation</code> event to load a spinner before the content is loaded and stop it immediately after loading. Note that using the loader callback in this way allows asynchronous execution of code.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;script is:inline>  document.addEventListener('astro:before-preparation', event => {    const originalLoader = event.loader;    event.loader = async function() {      const { startSpinner } = await import('./spinner.js');      const stop = startSpinner();      await originalLoader();      stop();    };  });&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="astroafter-preparation"><code>astro:after-preparation</code></h3>
<p><a href="#astroafter-preparation">Section titled astro:after-preparation</a></p>
<p><strong>Added in:</strong>
<code>astro@3.6.0</code></p>
<p>An event that fires at the end of the preparation phase, after the new page’s content has been loaded and parsed into a document. This event occurs before the view transitions phase.</p>
<p>This example uses the <code>astro:before-preparation</code> event to start a loading indicator and the <code>astro:after-preparation</code> event to stop it:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;script is:inline>  document.addEventListener('astro:before-preparation', () => {    document.querySelector('#loading').classList.add('show');  });  document.addEventListener('astro:after-preparation', () => {    document.querySelector('#loading').classList.remove('show');  });&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<p>This is a simpler version of loading a spinner than the example shown above: if all of the listener’s code can be executed synchronously, there is no need to hook into the loader’s callback.</p>
<h3 id="astrobefore-swap"><code>astro:before-swap</code></h3>
<p><a href="#astrobefore-swap">Section titled astro:before-swap</a></p>
<p><strong>Added in:</strong>
<code>astro@3.6.0</code></p>
<p>An event that fires before the new document (which is populated during the preparation phase) replaces the current document. This event occurs inside of the view transition, where the user is still seeing a snapshot of the old page.</p>
<p>This event can be used to make changes before the swap occurs. The <code>newDocument</code> property on the event represents the incoming document. Here is an example of ensuring the browser’s light or dark mode preference in <code>localStorage</code> is carried over to the new page:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;script is:inline>  function setDarkMode(document) {    let theme = localStorage.darkMode ? 'dark' : 'light';    document.documentElement.dataset.theme = theme;  }</span></span>
<span class="line"><span>  setDarkMode(document);</span></span>
<span class="line"><span>  document.addEventListener('astro:before-swap', event => {    // Pass the incoming document to set the theme on it    setDarkMode(event.newDocument);  });&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<p>The <code>astro:before-swap</code> event can also be used to change the <em>implementation</em> of the swap. The default swap implementation diffs head content, moves <strong>persistent</strong> elements from the old document to the <code>newDocument</code>, and then replaces the entire <code>body</code> with the body of the new document.</p>
<p>At this point of the lifecycle, you could choose to define your own swap implementation, for example to diff the entire contents of the existing document (which some other routers do):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;script is:inline>  document.addEventListener('astro:before-swap', event => {    event.swap = () => {      diff(document, event.newDocument);    };  });&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<h4 id="building-a-custom-swap-function">Building a custom swap function</h4>
<p><a href="#building-a-custom-swap-function">Section titled Building a custom swap function</a></p>
<p><strong>Added in:</strong>
<code>astro@4.15.0</code></p>
<p>The <code>swapFunctions</code> object of the <code>astro:transitions/client</code> module provides five utility functions that handle specific swap-related tasks, including handling document attributes, page elements, and script execution. These functions can be used directly to define a custom swap implementation.</p>
<p>The following example demonstrates how to use these functions to recreate Astro’s built-in swap implementation:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;script>import { swapFunctions } from 'astro:transitions/client';</span></span>
<span class="line"><span>// substitutes window.document with docfunction mySwap(doc: Document) {  swapFunctions.deselectScripts(doc);  swapFunctions.swapRootAttributes(doc);  swapFunctions.swapHeadElements(doc);  const restoreFocusFunction = swapFunctions.saveFocus();  swapFunctions.swapBodyElement(doc.body, document.body);  restoreFocusFunction();};</span></span>
<span class="line"><span>...  event.swap = () => mySwap(event.newDocument);...&#x3C;script></span></span>
<span class="line"><span></span></span></code></pre>
<p>Custom swap implementations can start with this template and add or replace individual steps with custom logic as needed.</p>
<h3 id="astroafter-swap"><code>astro:after-swap</code></h3>
<p><a href="#astroafter-swap">Section titled astro:after-swap</a>
An event that fires immediately after the new page replaces the old page. You can listen to this event on the <code>document</code> and trigger actions that will occur before the new page’s DOM elements render and scripts run.</p>
<p>This event, when listened to on the <strong>outgoing page</strong>, is useful to pass along and restore any state on the DOM that needs to transfer over to the new page.</p>
<p>This is the latest point in the lifecycle where it is still safe to, for example, add a dark mode class name (<code>&#x3C;html class="dark-mode"></code>), though you may wish to do so in an earlier event.</p>
<p>The <code>astro:after-swap</code> event occurs immediately after the browser history has been updated and the scroll position has been set.
Therefore, one use of targeting this event is to override the default scroll restore for history navigation. The following example resets the horizontal and vertical scroll position to the top left corner of the page for each navigation.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>document.addEventListener('astro:after-swap',  () => window.scrollTo({ left: 0, top: 0, behavior: 'instant' }))</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="astropage-load"><code>astro:page-load</code></h3>
<p><a href="#astropage-load">Section titled astro:page-load</a>
An event that fires at the end of page navigation, after the new page is visible to the user and blocking styles and scripts are loaded. You can listen to this event on the <code>document</code>.</p>
<p>The <code>&#x3C;ViewTransitions /></code> component fires this event both on initial page navigation for a pre-rendered page and on any subsequent navigation, either forwards or backwards.</p>
<p>You can use this event to run code on every page navigation, for example to set up event listeners that would otherwise be lost during navigation.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;script>  document.addEventListener('astro:page-load', () => {    // This runs on first page load and after every navigation.    setupStuff(); // e.g. add event listeners  });&#x3C;/script></span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="accessibility">Accessibility</h2>
<p><a href="#accessibility">Section titled Accessibility</a>
Enabling client-side routing and animating page transitions both come with accessibility challenges, and Astro aims to make sites opting in to View Transitions as accessible-by-default as possible.</p>
<h3 id="route-announcement">Route announcement</h3>
<p><a href="#route-announcement">Section titled Route announcement</a></p>
<p><strong>Added in:</strong>
<code>astro@3.2.0</code></p>
<p>The <code>&#x3C;ViewTransitions /></code> component includes a route announcer for page navigation during client-side routing. No configuration or action is needed to enable this.</p>
<p>Assistive technologies let visitors know that the page has changed by announcing the new page title after navigation. When using server-side routing with traditional full-page browser refreshes, this happens by default after the new page loads. In client-side routing, the <code>&#x3C;ViewTransitions /></code> component performs this action.</p>
<p>To add route announcement to client-side routing, the component adds an element to the new page with the <code>aria-live</code> attribute set to <code>assertive</code>. This tells AT (assistive technology) to announce immediately. The component also checks for the following, in priority order, to determine the announcement text:</p>
<ul>
<li>The <code>&#x3C;title></code>, if it exists.</li>
<li>The first <code>&#x3C;h1></code> it finds.</li>
<li>The <code>pathname</code> of the page.</li>
</ul>
<p>We strongly recommend you always include a <code>&#x3C;title></code> in each page for accessibility.</p>
<h3 id="prefers-reduced-motion"><code>prefers-reduced-motion</code></h3>
<p><a href="#prefers-reduced-motion">Section titled prefers-reduced-motion</a>
Astro’s <code>&#x3C;ViewTransitions /></code> component includes a CSS media query that disables <em>all</em> view transition animations, including fallback animation, whenever the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion"><code>prefer-reduced-motion</code></a> setting is detected. Instead, the browser will simply swap the DOM elements without an animation.</p>
<p>Learn</p> </div> <div class="prose-a:no-underline flex gap-2"> <span class="badge badge-outline badge-md"> <a href="/tags/astro/1/">astro</a> </span><span class="badge badge-outline badge-md"> <a href="/tags/Python/1/">Python</a> </span><span class="badge badge-outline badge-md"> <a href="/tags/Less/1/">Less</a> </span> </div> <div class="mt-4 flex justify-between"> <small>Publish on <span class="font-weight-bold">2024-03-02</span>，Update on <span class="font-weight-bold">2025-01-09</span></small> </div> </article> <div class="mt-12"> <div class="grid grid-cols-1 gap-4 md:grid-cols-3"> <div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/learn-the-basics-basics-astro-pages/"> <picture> <source srcset="/_astro/photo-1463130456064-77fda7f96d6b_ZAMhtG.avif 392w, /_astro/photo-1463130456064-77fda7f96d6b_Z1MkAzp.avif 700w, /_astro/photo-1463130456064-77fda7f96d6b_zovdG.avif 980w, /_astro/photo-1463130456064-77fda7f96d6b_Z1fOymS.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1463130456064-77fda7f96d6b_Z1fOymS.avif" srcset="/_astro/photo-1463130456064-77fda7f96d6b_ZAMhtG.avif 392w, /_astro/photo-1463130456064-77fda7f96d6b_Z1MkAzp.avif 700w, /_astro/photo-1463130456064-77fda7f96d6b_zovdG.avif 980w, /_astro/photo-1463130456064-77fda7f96d6b_Z1fOymS.avif 1960w" alt="white concrete building wall" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">documentation</span><span class="badge badge-outline">Python</span><span class="badge badge-outline">Less</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-03-04</span></p> <h2 class="card-title">Pages</h2> </div> </a> </div><div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/welcome-world-tutorial-0-introduction/"> <picture> <source srcset="/_astro/photo-1483366774565-c783b9f70e2c_jGYEQ.avif 392w, /_astro/photo-1483366774565-c783b9f70e2c_ZQPjpR.avif 700w, /_astro/photo-1483366774565-c783b9f70e2c_1uSMne.avif 980w, /_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif" srcset="/_astro/photo-1483366774565-c783b9f70e2c_jGYEQ.avif 392w, /_astro/photo-1483366774565-c783b9f70e2c_ZQPjpR.avif 700w, /_astro/photo-1483366774565-c783b9f70e2c_1uSMne.avif 980w, /_astro/photo-1483366774565-c783b9f70e2c_21yqnd.avif 1960w" alt="worm's-eye view photography of concrete building" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">astro-build</span><span class="badge badge-outline">Python</span><span class="badge badge-outline">Sass</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-03-03</span></p> <h2 class="card-title">Build your first Astro Blog</h2> </div> </a> </div><div class="card mb-4 overflow-hidden rounded-xl border  transition-transform duration-500 hover:-translate-y-1 hover:scale-105"> <a href="/posts/connect-your-data-guides-astro-db/"> <picture> <source srcset="/_astro/photo-1443641723753-250ff9bb3c83_1k4Hzr.avif 392w, /_astro/photo-1443641723753-250ff9bb3c83_8wotI.avif 700w, /_astro/photo-1443641723753-250ff9bb3c83_2vgvhO.avif 980w, /_astro/photo-1443641723753-250ff9bb3c83_Z2nhg62.avif 1960w" type="image/avif" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px"> <img src="/_astro/photo-1443641723753-250ff9bb3c83_Z2nhg62.avif" srcset="/_astro/photo-1443641723753-250ff9bb3c83_1k4Hzr.avif 392w, /_astro/photo-1443641723753-250ff9bb3c83_8wotI.avif 700w, /_astro/photo-1443641723753-250ff9bb3c83_2vgvhO.avif 980w, /_astro/photo-1443641723753-250ff9bb3c83_Z2nhg62.avif 1960w" alt="black concrete building during daytime" sizes="(max-width: 360px) 392px, 
           (max-width: 720px) 700px, 
           (max-width: 1600px) 980px, 
           1960px" class="mx-auto w-full max-w-full object-cover" width="1960" height="1102" loading="lazy" decoding="async"> </picture> <div class="card-body"> <div class="flex items-center gap-1 text-xs"> <span class="badge badge-outline">guide</span><span class="badge badge-outline">Python</span><span class="badge badge-outline">Css</span> </div> <p class="text-xs"><span class="font-weight-bold">2024-02-29</span></p> <h2 class="card-title">Astro DB</h2> </div> </a> </div> </div> </div> </main>  </main> <footer class="mx-auto mt-auto w-full max-w-[85rem] py-10"> <nav class="mx-auto w-full max-w-[85rem] px-4" aria-label="Footer"> <div class="flex flex-col items-center sm:flex-row sm:justify-between"> <div id="navbar-alignment" class="internal-links sm:order-2"> <div class="mt-2 flex flex-row gap-5 sm:mt-0 sm:flex-row sm:items-center sm:ps-5"> <a href="/posts/core-concepts-concepts-why-astro/" class="inline-flex gap-x-2 text-sm"> Astro </a><a href="/posts/assets-guides-styling/" class="inline-flex gap-x-2 text-sm"> Styling </a><a href="/tags/" class="inline-flex gap-x-2 text-sm"> Tags </a> </div> </div> <div class="mt-2 flex flex-wrap gap-2 sm:order-3 sm:mb-0 sm:gap-0"> <button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="/rss.xml" class="absolute inset-0 z-10" aria-label="RSS"></a> <i class="i-tabler-rss icon-base"></i> </button><button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="https://twitter.com/astrodotbuild" class="absolute inset-0 z-10" aria-label="Twitter"></a> <i class="i-tabler-brand-twitter icon-base"></i> </button><button type="button" class="relative inline-flex h-12 w-12 items-center gap-x-2 px-4 py-3 disabled:pointer-events-none disabled:opacity-50"> <a href="https://github.com/isooosi" class="absolute inset-0 z-10" aria-label="GitHub"></a> <i class="i-tabler-brand-github icon-base"></i> </button> </div> <div class="mt-2 sm:order-1 sm:mb-0"> <a class="flex-none text-sm" href="/" aria-label="Brand">AstroMelody &copy; 2025</a> </div> </div> </nav> </footer> </body></html>